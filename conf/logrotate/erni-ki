# ERNI-KI Log Rotation Configuration
# Automatic log rotation with 7-day retention

# Local monitoring logs
/home/konstantin/Documents/augment-projects/erni-ki/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 644 konstantin konstantin
    copytruncate

    # Restart services after rotation (if needed)
    postrotate
        # Send HUP to nginx to reopen logs
        /usr/bin/docker-compose -f /home/konstantin/Documents/augment-projects/erni-ki/compose.yml exec nginx nginx -s reopen >/dev/null 2>&1 || true
    endscript
}

# Backup logs
/home/konstantin/Documents/augment-projects/erni-ki/.config-backup/logs/*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    create 644 konstantin konstantin
    copytruncate
}

# Critical logs (longer retention)
/home/konstantin/Documents/augment-projects/erni-ki/monitoring/logs/critical/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 konstantin konstantin
    copytruncate

    # Notify about critical errors
    postrotate
        if [ -s "$1" ]; then
            echo "Critical errors found in rotated log: $1" | logger -t erni-ki-logrotate
        fi
    endscript
}

# Fluent Bit database files (size cap)
/home/konstantin/Documents/augment-projects/erni-ki/data/fluent-bit/db/*.db-wal {
    size 50M
    rotate 3
    compress
    delaycompress
    missingok
    notifempty
    create 644 root root
    copytruncate
}
