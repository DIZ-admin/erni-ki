{
  "uid": "ai-stack-ops",
  "title": "AI Stack Operations",
  "description": "Comprehensive AI services monitoring: Ollama, GPU, LiteLLM, RAG Pipeline, OpenWebUI",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 3,
  "refresh": "15s",
  "tags": ["erni-ki", "ai-services", "ollama", "gpu", "litellm", "rag"],
  "time": {"from": "now-3h", "to": "now"},
  "templating": {
    "list": [
      {
        "name": "interval",
        "type": "interval",
        "query": "30s,1m,5m,10m",
        "current": {"text": "1m", "value": "1m"},
        "auto": true,
        "auto_min": "30s"
      }
    ]
  },
  "panels": [
    {
      "type": "row",
      "title": "AI Services Health Overview",
      "id": 100,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0},
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "Ollama",
      "id": 1,
      "gridPos": {"h": 3, "w": 3, "x": 0, "y": 1},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "probe_success{instance=\"http://ollama:11434/api/version\",job=\"blackbox-internal\"}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [{"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}, "1": {"text": "UP", "color": "green"}}}],
          "noValue": "N/A"
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "background"}
    },
    {
      "type": "stat",
      "title": "OpenWebUI",
      "id": 2,
      "gridPos": {"h": 3, "w": 3, "x": 3, "y": 1},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "probe_success{instance=~\".*openwebui.*\"}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [{"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}, "1": {"text": "UP", "color": "green"}}}],
          "noValue": "N/A"
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "background"}
    },
    {
      "type": "stat",
      "title": "LiteLLM",
      "id": 3,
      "gridPos": {"h": 3, "w": 3, "x": 6, "y": 1},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "probe_success{instance=~\".*litellm.*\"}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [{"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}, "1": {"text": "UP", "color": "green"}}}],
          "noValue": "N/A"
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "background"}
    },
    {
      "type": "stat",
      "title": "SearXNG",
      "id": 4,
      "gridPos": {"h": 3, "w": 3, "x": 9, "y": 1},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "probe_success{instance=\"http://nginx:8080/searxng/\"}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [{"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}, "1": {"text": "UP", "color": "green"}}}],
          "noValue": "N/A"
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "background"}
    },
    {
      "type": "stat",
      "title": "Docling",
      "id": 5,
      "gridPos": {"h": 3, "w": 3, "x": 12, "y": 1},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "probe_success{instance=~\".*docling.*\"}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [{"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}, "1": {"text": "UP", "color": "green"}}}],
          "noValue": "N/A"
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "background"}
    },
    {
      "type": "stat",
      "title": "Tika",
      "id": 6,
      "gridPos": {"h": 3, "w": 3, "x": 15, "y": 1},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "probe_success{instance=~\".*tika.*\"}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [{"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}, "1": {"text": "UP", "color": "green"}}}],
          "noValue": "N/A"
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "background"}
    },
    {
      "type": "stat",
      "title": "EdgeTTS",
      "id": 7,
      "gridPos": {"h": 3, "w": 3, "x": 18, "y": 1},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "probe_success{instance=\"http://edgetts:5050/v1/models\"}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [{"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}, "1": {"text": "UP", "color": "green"}}}],
          "noValue": "N/A"
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "background"}
    },
    {
      "type": "stat",
      "title": "Auth",
      "id": 8,
      "gridPos": {"h": 3, "w": 3, "x": 21, "y": 1},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "probe_success{instance=~\".*auth.*\"}", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "mappings": [{"type": "value", "options": {"0": {"text": "DOWN", "color": "red"}, "1": {"text": "UP", "color": "green"}}}],
          "noValue": "N/A"
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "background"}
    },
    {
      "type": "row",
      "title": "NVIDIA GPU Metrics",
      "id": 101,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 4},
      "collapsed": false
    },
    {
      "type": "gauge",
      "title": "GPU Utilization",
      "id": 10,
      "gridPos": {"h": 5, "w": 4, "x": 0, "y": 5},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(nvidia_gpu_duty_cycle) or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0, "max": 100,
          "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 80}, {"color": "red", "value": 95}]}
        }
      }
    },
    {
      "type": "gauge",
      "title": "GPU Memory",
      "id": 11,
      "gridPos": {"h": 5, "w": 4, "x": 4, "y": 5},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "(max(nvidia_gpu_memory_used_bytes) / max(nvidia_gpu_memory_total_bytes)) * 100 or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0, "max": 100,
          "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 80}, {"color": "red", "value": 95}]}
        }
      }
    },
    {
      "type": "stat",
      "title": "GPU Temperature",
      "id": 12,
      "gridPos": {"h": 5, "w": 4, "x": 8, "y": 5},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(nvidia_gpu_temperature_celsius) or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "celsius",
          "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 70}, {"color": "orange", "value": 80}, {"color": "red", "value": 85}]}
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "value", "graphMode": "area"}
    },
    {
      "type": "stat",
      "title": "GPU Power",
      "id": 13,
      "gridPos": {"h": 5, "w": 4, "x": 12, "y": 5},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(nvidia_gpu_power_draw_watts) or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "watt",
          "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 200}, {"color": "red", "value": 300}]}
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "value"}
    },
    {
      "type": "stat",
      "title": "VRAM Used",
      "id": 14,
      "gridPos": {"h": 5, "w": 4, "x": 16, "y": 5},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(nvidia_gpu_memory_used_bytes) or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {"defaults": {"unit": "bytes"}},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}
    },
    {
      "type": "stat",
      "title": "VRAM Total",
      "id": 15,
      "gridPos": {"h": 5, "w": 4, "x": 20, "y": 5},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(nvidia_gpu_memory_total_bytes) or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {"defaults": {"unit": "bytes"}},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}
    },
    {
      "type": "timeseries",
      "title": "GPU Utilization & Memory Over Time",
      "id": 20,
      "gridPos": {"h": 7, "w": 12, "x": 0, "y": 10},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(nvidia_gpu_duty_cycle) or vector(0)", "legendFormat": "GPU Util %", "refId": "A"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "(max(nvidia_gpu_memory_used_bytes) / max(nvidia_gpu_memory_total_bytes)) * 100 or vector(0)", "legendFormat": "VRAM %", "refId": "B"}
      ],
      "fieldConfig": {"defaults": {"unit": "percent", "min": 0, "max": 100}},
      "options": {"legend": {"showLegend": true, "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "type": "timeseries",
      "title": "GPU Temperature & Power",
      "id": 21,
      "gridPos": {"h": 7, "w": 12, "x": 12, "y": 10},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(nvidia_gpu_temperature_celsius) or vector(0)", "legendFormat": "Temperature", "refId": "A"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(nvidia_gpu_power_draw_watts) or vector(0)", "legendFormat": "Power", "refId": "B"}
      ],
      "fieldConfig": {
        "defaults": {"unit": "short"},
        "overrides": [
          {"matcher": {"id": "byName", "options": "Temperature"}, "properties": [{"id": "unit", "value": "celsius"}]},
          {"matcher": {"id": "byName", "options": "Power"}, "properties": [{"id": "unit", "value": "watt"}]}
        ]
      },
      "options": {"legend": {"showLegend": true, "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "type": "row",
      "title": "Ollama LLM Inference",
      "id": 102,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 17},
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "Models Loaded",
      "id": 30,
      "gridPos": {"h": 4, "w": 4, "x": 0, "y": 18},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "ollama_installed_models or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}
    },
    {
      "type": "stat",
      "title": "Request Latency",
      "id": 31,
      "gridPos": {"h": 4, "w": 4, "x": 4, "y": 18},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "ollama_request_latency_seconds or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 2}, {"color": "red", "value": 5}]}
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "value"}
    },
    {
      "type": "timeseries",
      "title": "Ollama Container Resources",
      "id": 35,
      "gridPos": {"h": 7, "w": 16, "x": 8, "y": 18},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "sum(rate(container_cpu_usage_seconds_total{name=~\".*ollama.*\"}[$interval]))", "legendFormat": "CPU (cores)", "refId": "A"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(container_memory_usage_bytes{name=~\".*ollama.*\"}) / 1024 / 1024 / 1024", "legendFormat": "Memory (GB)", "refId": "B"}
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "options": {"legend": {"showLegend": true, "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "type": "row",
      "title": "LiteLLM AI Gateway",
      "id": 103,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 25},
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "LiteLLM Container Resources",
      "id": 40,
      "gridPos": {"h": 7, "w": 12, "x": 0, "y": 26},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "sum(rate(container_cpu_usage_seconds_total{name=~\".*litellm.*\"}[$interval]))", "legendFormat": "CPU (cores)", "refId": "A"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(container_memory_usage_bytes{name=~\".*litellm.*\"}) / 1024 / 1024", "legendFormat": "Memory (MB)", "refId": "B"}
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "options": {"legend": {"showLegend": true, "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "type": "timeseries",
      "title": "LiteLLM Network I/O",
      "id": 41,
      "gridPos": {"h": 7, "w": 12, "x": 12, "y": 26},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "sum(rate(container_network_receive_bytes_total{name=~\".*litellm.*\"}[$interval]))", "legendFormat": "Received", "refId": "A"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "-sum(rate(container_network_transmit_bytes_total{name=~\".*litellm.*\"}[$interval]))", "legendFormat": "Transmitted", "refId": "B"}
      ],
      "fieldConfig": {"defaults": {"unit": "Bps"}},
      "options": {"legend": {"showLegend": true, "placement": "bottom"}}
    },
    {
      "type": "row",
      "title": "RAG Pipeline (Docling, Tika, SearXNG)",
      "id": 104,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 33},
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "RAG Sources",
      "id": 50,
      "gridPos": {"h": 4, "w": 4, "x": 0, "y": 34},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "rag_sources_count or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}}
    },
    {
      "type": "stat",
      "title": "RAG Latency",
      "id": 51,
      "gridPos": {"h": 4, "w": 4, "x": 4, "y": 34},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "rag_openwebui_latency_seconds or vector(0)", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 1}, {"color": "red", "value": 3}]}
        }
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"]}, "colorMode": "value"}
    },
    {
      "type": "timeseries",
      "title": "RAG & Document Processing Services Resources",
      "id": 55,
      "gridPos": {"h": 7, "w": 16, "x": 8, "y": 34},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "sum(rate(container_cpu_usage_seconds_total{name=~\".*(docling|tika|searxng).*\"}[$interval])) by (name)", "legendFormat": "{{name}} CPU", "refId": "A"}
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "options": {"legend": {"showLegend": true, "placement": "right"}}
    },
    {
      "type": "row",
      "title": "OpenWebUI Frontend",
      "id": 105,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 41},
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "OpenWebUI Container Resources",
      "id": 60,
      "gridPos": {"h": 6, "w": 12, "x": 0, "y": 42},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "sum(rate(container_cpu_usage_seconds_total{name=~\".*openwebui.*\"}[$interval]))", "legendFormat": "CPU (cores)", "refId": "A"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "max(container_memory_usage_bytes{name=~\".*openwebui.*\"}) / 1024 / 1024", "legendFormat": "Memory (MB)", "refId": "B"}
      ],
      "fieldConfig": {"defaults": {"unit": "short"}},
      "options": {"legend": {"showLegend": true, "placement": "bottom"}}
    },
    {
      "type": "timeseries",
      "title": "Frontend Request Rate",
      "id": 61,
      "gridPos": {"h": 6, "w": 12, "x": 12, "y": 42},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "sum(rate(nginx_http_requests_total[$interval]))", "legendFormat": "Total req/s", "refId": "A"}
      ],
      "fieldConfig": {"defaults": {"unit": "reqps"}},
      "options": {"legend": {"showLegend": true, "placement": "bottom"}}
    },
    {
      "type": "row",
      "title": "Redis Cache (AI Sessions)",
      "id": 106,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 48},
      "collapsed": false
    },
    {
      "type": "gauge",
      "title": "Cache Hit Ratio",
      "id": 70,
      "gridPos": {"h": 5, "w": 4, "x": 0, "y": 49},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "(rate(redis_keyspace_hits_total[$interval]) / clamp_min(rate(redis_keyspace_hits_total[$interval]) + rate(redis_keyspace_misses_total[$interval]), 0.001)) * 100", "refId": "A"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0, "max": 100,
          "thresholds": {"mode": "absolute", "steps": [{"color": "red", "value": 0}, {"color": "yellow", "value": 80}, {"color": "green", "value": 95}]}
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Redis Operations",
      "id": 71,
      "gridPos": {"h": 6, "w": 10, "x": 4, "y": 49},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "rate(redis_commands_processed_total[$interval])", "legendFormat": "Commands/s", "refId": "A"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "rate(redis_keyspace_hits_total[$interval])", "legendFormat": "Hits/s", "refId": "B"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "rate(redis_keyspace_misses_total[$interval])", "legendFormat": "Misses/s", "refId": "C"}
      ],
      "fieldConfig": {"defaults": {"unit": "ops"}},
      "options": {"legend": {"showLegend": true, "placement": "bottom"}}
    },
    {
      "type": "timeseries",
      "title": "Redis Memory",
      "id": 72,
      "gridPos": {"h": 6, "w": 10, "x": 14, "y": 49},
      "targets": [
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "redis_memory_used_bytes", "legendFormat": "Used", "refId": "A"},
        {"datasource": {"type": "prometheus", "uid": "prometheus"}, "expr": "redis_memory_max_bytes", "legendFormat": "Max", "refId": "B"}
      ],
      "fieldConfig": {"defaults": {"unit": "bytes"}},
      "options": {"legend": {"showLegend": true, "placement": "bottom"}}
    },
    {
      "type": "row",
      "title": "AI Services Logs",
      "id": 107,
      "gridPos": {"h": 1, "w": 24, "x": 0, "y": 55},
      "collapsed": false
    },
    {
      "type": "logs",
      "title": "AI Services Error Logs",
      "id": 80,
      "gridPos": {"h": 10, "w": 24, "x": 0, "y": 56},
      "datasource": {"type": "loki", "uid": "loki"},
      "targets": [
        {"datasource": {"type": "loki", "uid": "loki"}, "expr": "{container_name=~\".*(ollama|openwebui|litellm|docling|tika|searxng).*\"} |~ \"(?i)(error|exception|failed|timeout)\" | __error__=\"\"", "refId": "A"}
      ],
      "options": {"showLabels": true, "showTime": true, "wrapLogMessage": true, "enableLogDetails": true, "sortOrder": "Descending"}
    }
  ],
  "links": [
    {"title": "SRE Overview", "url": "/d/platform-sre-overview", "type": "link", "icon": "dashboard"},
    {"title": "Infrastructure", "url": "/d/core-infra-observability", "type": "link", "icon": "dashboard"}
  ]
}
