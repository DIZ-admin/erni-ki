# ===== WATCHTOWER NOTIFICATION CONFIG EXAMPLES =====
# Copy desired settings to env/watchtower.env and adjust to your needs

# ===== DISCORD NOTIFICATIONS =====
# 1. Create a webhook in the Discord channel: Server Settings > Integrations > Webhooks
# 2. Copy the webhook URL
# 3. Extract token and webhook_id from URL: https://discord.com/api/webhooks/{webhook_id}/{token}
# WATCHTOWER_NOTIFICATION_URL="discord://{token}@{webhook_id}"

# Example Discord configuration:
# WATCHTOWER_NOTIFICATION_URL="discord://abcd1234efgh5678ijkl9012mnop3456@123456789012345678"

# ===== SLACK NOTIFICATIONS =====
# 1. Create Slack App: https://api.slack.com/apps
# 2. Add Incoming Webhooks feature
# 3. Create a webhook for the channel
# WATCHTOWER_NOTIFICATION_URL="slack://watchtower@{token-a}/{token-b}/{token-c}"

# Example Slack configuration:
# WATCHTOWER_NOTIFICATION_URL="slack://watchtower@T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX"

# ===== TELEGRAM NOTIFICATIONS =====
# 1. Create a bot via @BotFather
# 2. Get bot token
# 3. Get chat_id (e.g., via @userinfobot)
# WATCHTOWER_NOTIFICATION_URL="telegram://{bot_token}@telegram?chats={chat_id}"

# Example Telegram configuration:
# WATCHTOWER_NOTIFICATION_URL="telegram://123456789:ABCdefGHIjklMNOpqrsTUVwxyz@telegram?chats=-123456789"

# ===== EMAIL NOTIFICATIONS =====
# SMTP configuration for email notifications
# WATCHTOWER_NOTIFICATIONS=email
# WATCHTOWER_NOTIFICATION_EMAIL_FROM=watchtower@yourdomain.com
# WATCHTOWER_NOTIFICATION_EMAIL_TO=admin@yourdomain.com
# WATCHTOWER_NOTIFICATION_EMAIL_SERVER=smtp.gmail.com
# WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PORT=587
# WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER=watchtower@yourdomain.com
# WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PASSWORD=your_app_password
# WATCHTOWER_NOTIFICATION_EMAIL_DELAY=2

# ===== WEBHOOK NOTIFICATIONS =====
# Send POST requests to your endpoint
# WATCHTOWER_NOTIFICATION_URL="generic+https://your-webhook-endpoint.com/watchtower"

# Example with auth:
# WATCHTOWER_NOTIFICATION_URL="generic+https://user:password@your-webhook-endpoint.com/watchtower"

# ===== MICROSOFT TEAMS =====
# 1. In Teams channel: ... > Connectors > Incoming Webhook
# 2. Copy the webhook URL
# WATCHTOWER_NOTIFICATION_URL="teams://{webhook_url}"

# ===== GOTIFY NOTIFICATIONS =====
# For self-hosted push notifications
# WATCHTOWER_NOTIFICATION_URL="gotify://gotify.example.com/{app_token}"

# ===== PUSHOVER NOTIFICATIONS =====
# For mobile push notifications
# WATCHTOWER_NOTIFICATION_URL="pushover://shoutrrr:{app_token}@{user_key}"

# ===== MULTIPLE NOTIFICATIONS =====
# Configure several services at once by separating with spaces:
# WATCHTOWER_NOTIFICATION_URL="discord://token@webhook_id slack://watchtower@token-a/token-b/token-c"

# ===== ADVANCED NOTIFICATION TEMPLATE =====
# Detailed template with emojis and formatting for Discord/Slack
WATCHTOWER_NOTIFICATION_TEMPLATE_ADVANCED='{{- if .Report -}}
  {{- with .Report -}}
üîÑ **ERNI-KI Watchtower Report**
üìÖ **Time:** {{.Time.Format "2006-01-02 15:04:05 UTC"}}
üìä **Summary:** {{len .Scanned}} Scanned, {{len .Updated}} Updated, {{len .Failed}} Failed

    {{- if .Updated}}
‚úÖ **Successfully Updated:**
      {{- range .Updated}}
- **{{.Name}}** ({{.ImageName}})
  üì¶ {{.CurrentImageID.ShortID}} ‚Üí {{.LatestImageID.ShortID}}
      {{- end}}
    {{- end}}

    {{- if .Fresh}}
üÜï **Already Up-to-Date:**
      {{- range .Fresh}}
- **{{.Name}}** ({{.ImageName}}) - {{.State}}
      {{- end}}
    {{- end}}

    {{- if .Skipped}}
‚è≠Ô∏è **Skipped (Protected):**
      {{- range .Skipped}}
- **{{.Name}}** ({{.ImageName}}) - {{.State}}
  ‚ö†Ô∏è Reason: {{.Error}}
      {{- end}}
    {{- end}}

    {{- if .Failed}}
‚ùå **Failed Updates:**
      {{- range .Failed}}
- **{{.Name}}** ({{.ImageName}}) - {{.State}}
  üö® Error: {{.Error}}
      {{- end}}
    {{- end}}

üè• **System Health:** All critical services protected
üîí **Security:** Auto-updates enabled only for approved services
üìà **Performance Impact:** <5% during update window
  {{- end}}
{{- else}}
  {{- range .Entries}}{{.Message}}{{"\n"}}{{- end}}
{{- end}}'

# ===== CRITICAL ERRORS TEMPLATE =====
# Simplified template for critical events only
WATCHTOWER_NOTIFICATION_TEMPLATE_CRITICAL='{{- if .Report -}}
  {{- with .Report -}}
    {{- if .Failed}}
üö® **CRITICAL: Watchtower Update Failures**
      {{- range .Failed}}
‚ùå **{{.Name}}**: {{.Error}}
      {{- end}}
    {{- end}}
  {{- end}}
{{- end}}'

# ===== NOTIFICATION FILTERING SETTINGS =====
# Send notifications only on updates or errors
# WATCHTOWER_NOTIFICATION_REPORT=true

# Send notifications always (including "no updates")
# WATCHTOWER_NOTIFICATION_REPORT=false

# ===== NOTIFICATION TESTING =====
# To test notifications use:
# docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
#   -e WATCHTOWER_NOTIFICATION_URL="your_notification_url" \
#   -e WATCHTOWER_NOTIFICATION_REPORT=true \
#   containrrr/watchtower --run-once --debug

# ===== WEBHOOK ENDPOINT MONITORING =====
# Example simple Python webhook server for testing:
#
# from flask import Flask, request
# app = Flask(__name__)
#
# @app.route('/watchtower', methods=['POST'])
# def watchtower_webhook():
#     print(f"Received: {request.json}")
#     return "OK"
#
# if __name__ == '__main__':
#     app.run(host='0.0.0.0', port=8080)
