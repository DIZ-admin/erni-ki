{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "description": "Renovate configuration for erni-ki project - –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π",
  "extends": ["config:base", "docker:enableMajor", "helpers:pinGitHubActionsByDigest"],

  "timezone": "Europe/Moscow",
  "schedule": ["before 6am on monday"],

  "labels": ["dependencies", "renovate"],
  "assignees": ["@DIZ-admin"],
  "reviewers": ["@DIZ-admin"],

  "prConcurrentLimit": 3,
  "prHourlyLimit": 2,
  "branchConcurrentLimit": 5,

  "commitMessagePrefix": "‚¨ÜÔ∏è",
  "commitMessageAction": "update",
  "commitMessageTopic": "{{depName}}",
  "commitMessageExtra": "to {{newVersion}}",

  "prTitle": "‚¨ÜÔ∏è Update {{depName}} to {{newVersion}}",
  "prBodyTemplate": "This PR updates {{depName}} from {{currentVersion}} to {{newVersion}}.\n\n{{#if hasReleaseNotes}}**Release Notes:**\n{{{releaseNotes}}}{{/if}}\n\n---\n*This PR was generated automatically by Renovate Bot.*",

  "packageRules": [
    {
      "description": "Go dependencies - –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –º–∏–Ω–æ—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
      "matchManagers": ["gomod"],
      "groupName": "Go dependencies (minor)",
      "matchUpdateTypes": ["minor", "patch"],
      "schedule": ["before 6am on monday"]
    },
    {
      "description": "Go major updates - –æ—Ç–¥–µ–ª—å–Ω—ã–µ PR",
      "matchManagers": ["gomod"],
      "matchUpdateTypes": ["major"],
      "schedule": ["before 6am on first day of month"]
    },
    {
      "description": "Docker images - –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π",
      "matchManagers": ["dockerfile", "docker-compose"],
      "groupName": "Docker images",
      "matchUpdateTypes": ["minor", "patch"],
      "schedule": ["before 6am on monday"],
      "minimumReleaseAge": "3 days"
    },
    {
      "description": "Docker major updates - —Ç—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏",
      "matchManagers": ["dockerfile", "docker-compose"],
      "matchUpdateTypes": ["major"],
      "schedule": ["before 6am on first day of month"],
      "minimumReleaseAge": "7 days"
    },
    {
      "description": "GitHub Actions - –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
      "matchManagers": ["github-actions"],
      "groupName": "GitHub Actions",
      "matchUpdateTypes": ["minor", "patch"],
      "schedule": ["before 6am on monday"]
    },

    {
      "description": "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ security –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ",
      "matchPackagePatterns": ["*"],
      "matchUpdateTypes": ["patch"],
      "labels": ["security", "dependencies"],
      "schedule": ["at any time"],
      "prPriority": 10,
      "automerge": false
    },
    {
      "description": "–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã - –∞–≤—Ç–æ—Å–ª–∏—è–Ω–∏–µ –ø–∞—Ç—á–µ–π",
      "matchPackageNames": ["nginx", "redis/redis-stack", "postgres", "alpine"],
      "matchUpdateTypes": ["patch"],
      "automerge": true,
      "automergeType": "pr",
      "requiredStatusChecks": null
    },
    {
      "description": "AI/ML –æ–±—Ä–∞–∑—ã - –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
      "matchPackageNames": [
        "ollama/ollama",
        "ghcr.io/open-webui/open-webui",
        "quay.io/docling-project/docling-serve"
      ],
      "schedule": ["before 6am on first day of month"],
      "minimumReleaseAge": "7 days",
      "labels": ["ai-services", "dependencies"]
    },
    {
      "description": "Cloudflare –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ–±—Ä–∞–∑—ã",
      "matchPackageNames": ["cloudflare/cloudflared", "containrrr/watchtower"],
      "schedule": ["before 6am on monday"],
      "minimumReleaseAge": "3 days"
    }
  ],

  "vulnerabilityAlerts": {
    "enabled": true,
    "schedule": ["at any time"],
    "prPriority": 20,
    "labels": ["security", "vulnerability"]
  },

  "osvVulnerabilityAlerts": true,

  "lockFileMaintenance": {
    "enabled": true,
    "schedule": ["before 6am on first day of month"],
    "commitMessageAction": "refresh",
    "prTitle": "üîí Refresh lock files"
  },

  "regexManagers": [
    {
      "description": "Update Go version in Dockerfile",
      "fileMatch": ["^auth/Dockerfile$"],
      "matchStrings": ["FROM golang:(?<currentValue>.*?)-alpine"],
      "datasourceTemplate": "docker",
      "depNameTemplate": "golang",
      "versioningTemplate": "docker"
    },
    {
      "description": "Update Go version in GitHub Actions",
      "fileMatch": ["^\\.github/workflows/.*\\.ya?ml$"],
      "matchStrings": ["go-version: ['\"]?(?<currentValue>.*?)['\"]?\\s"],
      "datasourceTemplate": "golang-version",
      "depNameTemplate": "golang"
    },
    {
      "description": "Update Node.js version in GitHub Actions",
      "fileMatch": ["^\\.github/workflows/.*\\.ya?ml$"],
      "matchStrings": ["node-version: ['\"]?(?<currentValue>.*?)['\"]?\\s"],
      "datasourceTemplate": "node-version",
      "depNameTemplate": "node"
    }
  ],

  "customManagers": [
    {
      "customType": "regex",
      "description": "Update versions in compose.yml.example",
      "fileMatch": ["^compose\\.yml\\.example$"],
      "matchStrings": ["image: (?<depName>.*?):(?<currentValue>.*?)\\s"],
      "datasourceTemplate": "docker"
    }
  ],

  "ignoreDeps": ["node", "npm"],

  "ignorePaths": ["**/node_modules/**", "**/vendor/**", "**/data/**", "**/logs/**"]
}
