# Fluent Bit Configuration for ERNI-KI
# Log collection and forwarding

# === Basics ===
# Fluent Bit log level
FLB_LOG_LEVEL=info
# Flush interval (seconds)
FLB_FLUSH_INTERVAL=5
# Buffer size for log reads
FLB_BUFFER_SIZE=32k

# === HTTP metrics server ===
# Enable HTTP server
FLB_HTTP_SERVER=On
# HTTP listen host
FLB_HTTP_LISTEN=0.0.0.0
# HTTP port
FLB_HTTP_PORT=2020

# === Loki output ===
# Loki host (container name)
LOKI_HOST=loki
# Loki HTTP API port
LOKI_PORT=3100
# Tenant ID (required if auth_enabled)
LOKI_TENANT_ID=erni-ki
# Labels to add to each record
LOKI_LABELS=job=fluent-bit,cluster=erni-ki,environment=production

# === Parsing ===
# Enable JSON parsing
FLB_PARSER_JSON=On
# Preserve original message
FLB_PARSER_PRESERVE_KEY=On
# Time key
FLB_PARSER_TIME_KEY=@timestamp
# Time format
FLB_PARSER_TIME_FORMAT=%Y-%m-%dT%H:%M:%S.%L

# === Filtering ===
# Add Kubernetes annotations
FLB_KUBERNETES_ANNOTATIONS=On
# Add Kubernetes labels
FLB_KUBERNETES_LABELS=On
# Exclude system namespaces
FLB_KUBERNETES_EXCLUDE_NAMESPACES=kube-system,kube-public

# === Performance ===
# Worker threads
FLB_WORKERS=2
# Max chunks buffered
FLB_STORAGE_MAX_CHUNKS_UP=128
# Storage path
FLB_STORAGE_PATH=/tmp/fluent-bit-storage

# === Monitoring ===
# Enable Prometheus metrics
FLB_PROMETHEUS_METRICS=On
# Prometheus metrics host
FLB_PROMETHEUS_HOST=0.0.0.0
# Порт для метрик Prometheus
FLB_PROMETHEUS_PORT=2021

# === Безопасность ===
# Отключить TLS для внутренней сети
FLB_TLS=Off
# Проверка SSL сертификатов
FLB_TLS_VERIFY=Off
