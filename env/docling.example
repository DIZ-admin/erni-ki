# Docling OCR Environment Configuration для ERNI-KI
# Скопировать в env/docling.env и настроить значения
# Дата обновления: 2025-09-19
# Статус: Production Ready - многоязычная OCR поддержка (EN, DE, FR, IT)

# === СТАНДАРТИЗИРОВАННОЕ ЛОГИРОВАНИЕ ===
LOG_LEVEL=warn
LOG_FORMAT=json

# === ОСНОВНЫЕ НАСТРОЙКИ DOCLING ===
# Включение веб-интерфейса для тестирования
DOCLING_SERVE_ENABLE_UI=true

# Включение remote services для работы с внешними API (Ollama)
DOCLING_SERVE_ENABLE_REMOTE_SERVICES=true
DOCLING_ENABLE_REMOTE_SERVICES=true

# === ПРОИЗВОДИТЕЛЬНОСТЬ И ОПТИМИЗАЦИЯ ===
# Увеличенные timeout'ы для больших файлов (production-ready)
DOCLING_SERVE_MAX_WORKERS=4
DOCLING_SERVE_TIMEOUT=600
DOCLING_SERVE_MAX_SYNC_WAIT=600
DOCLING_SERVE_REQUEST_TIMEOUT=600

# Контроль использования CPU и потоков
DOCLING_CPU_LIMIT=6
DOCLING_THREAD_POOL_SIZE=4
DOCLING_ASYNC_WORKERS=2

# === МНОГОЯЗЫЧНАЯ OCR ПОДДЕРЖКА ===
# Основной OCR движок (EasyOCR для стабильности)
DOCLING_OCR_ENGINE=easyocr

# Полное отключение Tesseract OSD для избежания критических ошибок
DOCLING_DISABLE_OSD=true
DOCLING_TESSERACT_DISABLE_OSD=true
DOCLING_TESSERACT_OSD_ONLY=false
DOCLING_TESSERACT_PSM=6

# Настройки DPI для качественного распознавания
DOCLING_OCR_DEFAULT_DPI=300
DOCLING_OCR_MIN_DPI=150
DOCLING_OCR_FORCE_DPI=true
DOCLING_PIPELINE_ENABLE_REMOTE_SERVICES=true

# === МНОГОЯЗЫЧНАЯ ПОДДЕРЖКА (EN, DE, FR, IT) ===
# Языки OCR для европейских документов
DOCLING_DEFAULT_LANG=en
DOCLING_OCR_LANGUAGES=en,de,fr,it
DOCLING_FORCE_SINGLE_LANG=false

# Автоматическое определение языка
DOCLING_AUTO_LANG_DETECT=true
DOCLING_MULTILANG_ENABLED=true
DOCLING_LANG_DETECTION_CONFIDENCE=0.7

# EasyOCR многоязычные настройки
EASYOCR_GPU=false
EASYOCR_VERBOSE=false
EASYOCR_LANG_LIST=en,de,fr,it
EASYOCR_DOWNLOAD_ENABLED=true
EASYOCR_BATCH_MAX_LENGTH=25
EASYOCR_WORKERS=2

# === БЕЗОПАСНОСТЬ И ЛИМИТЫ ===
# Максимальный размер файла для загрузки (100MB для RAG документов)
DOCLING_SERVE_MAX_FILE_SIZE=100MB

# Настройки для больших файлов
DOCLING_MAX_PAGES_PER_BATCH=3
DOCLING_MEMORY_LIMIT=8GB
DOCLING_ENABLE_STREAMING=true
DOCLING_CHUNK_SIZE=2MB
DOCLING_MAX_CONCURRENT_REQUESTS=2
DOCLING_QUEUE_SIZE=10

# === HUGGINGFACE НАСТРОЙКИ ===
# Кэширование моделей для производительности
HF_HOME=/opt/app-root/src/.cache/huggingface
HUGGINGFACE_HUB_CACHE=/opt/app-root/src/.cache/huggingface/hub
TRANSFORMERS_CACHE=/opt/app-root/src/.cache/huggingface/transformers
HF_HUB_DISABLE_SYMLINKS_WARNING=1
HF_HUB_DISABLE_EXPERIMENTAL_WARNING=1
HF_HUB_DISABLE_TELEMETRY=1

# === ПРОИЗВОДСТВЕННЫЕ НАСТРОЙКИ ===
# Обработка ошибок и fallback
DOCLING_CONTINUE_ON_ERROR=true
DOCLING_SKIP_PROBLEMATIC_PAGES=true
DOCLING_ERROR_RECOVERY_ENABLED=true

# Оптимизация производительности
DOCLING_BATCH_SIZE=4
DOCLING_CACHE_SIZE=1000
DOCLING_SERVE_OPTIONS_CACHE_SIZE=4

# === ВАЖНО: ИЗМЕНИТЬ ПЕРЕД ПРОДАКШЕНОМ ===
# ⚠️ Настройте пути кэширования согласно вашей инфраструктуре
# ⚠️ Проверьте доступность языковых моделей EasyOCR
# ⚠️ Настройте лимиты памяти согласно доступным ресурсам
# ⚠️ Включите мониторинг производительности OCR через Prometheus

# === CPU ОПТИМИЗАЦИЯ (для серверов без GPU) ===
# Принудительное использование CPU
DOCLING_FORCE_CPU=true
DOCLING_DISABLE_CUDA=true
EASYOCR_GPU=false
EASYOCR_FORCE_CPU=true

# Многопоточность для лучшей производительности
OMP_NUM_THREADS=8
MKL_NUM_THREADS=8
TORCH_NUM_THREADS=8
