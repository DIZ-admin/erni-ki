# Fluent Bit рабочая конфигурация для ERNI-KI
# Совместимость с Fluent Bit v3.0.7 и Elasticsearch 7.17.15

[SERVICE]
    Flush         5
    Daemon        off
    Log_Level     info
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

[INPUT]
    Name              forward
    Tag               docker.*
    Listen            0.0.0.0
    Port              24224
    Buffer_Chunk_Size 1M
    Buffer_Max_Size   6M

[INPUT]
    Name              tail
    Tag               system.*
    Path              /var/log/syslog
    DB                /fluent-bit/db/flb_syslog.db
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    Refresh_Interval  10

[FILTER]
    Name              record_modifier
    Match             *
    Record            cluster erni-ki
    Record            environment production

[FILTER]
    Name              record_modifier
    Match             docker.*
    Record            log_source docker

[OUTPUT]
    Name              es
    Match             *
    Host              elasticsearch
    Port              9200
    Index             erni-ki-logs
    Type              _doc
    Logstash_Format   On
    Logstash_Prefix   erni-ki
    Generate_ID       On
    tls               Off

[OUTPUT]
    Name              stdout
    Match             system.*
