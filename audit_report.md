# Отчет об аудите запуска проекта ERNI-KI

**Дата начала:** 2025-11-23 **Статус:** В процессе

## 1. Архитектура и Инфраструктура

### 1.1. Контейнеризация и Оркестрация

| Проверка                      | Статус         | Комментарий                                                                                                                                             |
| :---------------------------- | :------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Фиксация версий образов**   | ⚠️ Частично    | В основном зафиксированы. <br>❌ `docling` использует тег `main` по умолчанию.<br>⚠️ `pgvector:pg17`, `redis:7-alpine`, `uptime-kuma:1` — широкие теги. |
| **Политики перезапуска**      | ✅ Пройдено    | Все сервисы имеют `unless-stopped` или `always`.                                                                                                        |
| **Конфигурация Watchtower**   | ✅ Пройдено    | Отключено для критических сервисов (DB, Nginx, AI). <br>⚠️ Включено для Redis (риск обновления мажорной версии).                                        |
| **Лимиты ресурсов (CPU/RAM)** | ❌ Не пройдено | ✅ Установлены для AI сервисов (Ollama, LiteLLM, OpenWebUI). <br>❌ Отсутствуют для `db`, `redis`, `nginx`, `searxng` и стека мониторинга.              |
| **GPU конфигурация**          | ✅ Пройдено    | `runtime: nvidia` настроен корректно для Ollama, OpenWebUI, Docling.                                                                                    |

### 1.2. Сеть и Хранение данных

| Проверка                   | Статус      | Комментарий                                                                                                                  |
| :------------------------- | :---------- | :--------------------------------------------------------------------------------------------------------------------------- |
| **Сетевая изоляция**       | ⚠️ Частично | ✅ Большинство сервисов на `127.0.0.1` или без портов. <br>⚠️ `ollama` публикует порт `11434` на всех интерфейсах (0.0.0.0). |
| **Персистентность данных** | ✅ Пройдено | Все stateful сервисы используют bind mounts в `./data/` или именованные тома.                                                |
| **Бэкапы**                 | ✅ Пройдено | Сервис `backrest` настроен на бэкап всей директории `./data`, `./conf` и `./env`.                                            |

## 2. Безопасность

| Проверка                     | Статус      | Комментарий                                                                                                             |
| :--------------------------- | :---------- | :---------------------------------------------------------------------------------------------------------------------- |
| **Управление секретами**     | ✅ Пройдено | Используются Docker Secrets. Скрипты инициализации (напр. `litellm.sh`) корректно подгружают секреты.                   |
| **Сканирование уязвимостей** | ✅ Пройдено | Настроен `.gitleaks.toml`, есть скрипты `security:scan` в `package.json`.                                               |
| **Права доступа**            | ⚠️ Частично | `watchtower` требует root. `ollama`/`openwebui` работают от root (стандартно для Docker, но можно усилить).             |
| **Конфигурация Nginx**       | ❌ КРИТИЧНО | **Отсутствуют файлы конфигурации**: `conf/nginx/nginx.conf`, `conf/nginx/conf.d/default.conf`. Контейнер не запустится. |

## 3. Качество кода и Процессы разработки

| Проверка         | Статус      | Комментарий                                                                    |
| :--------------- | :---------- | :----------------------------------------------------------------------------- |
| **Тестирование** | ✅ Пройдено | Настроены Unit (Vitest) и E2E (Playwright) тесты. Есть спец. тесты для GPU/AI. |
| **Линтинг**      | ✅ Пройдено | ESLint, Prettier, Commitlint, TypeScript check настроены.                      |
| **CI/CD**        | ✅ Пройдено | Полный набор workflows: CI, Deploy, Release, Security.                         |

## 4. Наблюдаемость (Observability)

| Проверка          | Статус      | Комментарий                                                                           |
| :---------------- | :---------- | :------------------------------------------------------------------------------------ |
| **Логирование**   | ✅ Пройдено | Реализована 4-уровневая стратегия логирования. Интеграция Fluent Bit + Loki.          |
| **Мониторинг**    | ✅ Пройдено | Обширный стек: Prometheus, Grafana, Alertmanager. 10+ экспортеров (включая GPU и AI). |
| **Health Checks** | ✅ Пройдено | Healthchecks настроены практически для всех сервисов в `compose.yml`.                 |

## 5. Документация

_Ожидает проверки_
