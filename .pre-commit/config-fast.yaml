# Fast profile for local development (<2s per hook)
# Use with: pre-commit run --config .pre-commit/config-fast.yaml --all-files

minimum_pre_commit_version: "3.5.0"

default_language_version:
  python: python3.11
  node: "22.14.0"

repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-merge-conflict
      - id: check-yaml
      - id: check-json

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.6
    hooks:
      - id: ruff
        name: "Ruff: Python lint"
        args: [--fix]
      - id: ruff-format
        name: "Ruff: Python format"

  - repo: local
    hooks:
      - id: language-check
        name: "Language: validate language policy"
        entry: bun run lint:language -- --all
        language: system
        pass_filenames: false
        stages: [pre-commit]

      - id: ts-type-check
        name: "TypeScript: type check"
        entry: npm run type-check
        language: system
        pass_filenames: false
        stages: [pre-commit]
        files: \.(ts|tsx)$

      - id: check-todo-fixme
        name: "Code Quality: no inline task markers"
        entry: bash
        language: system
        types: [text]
        pass_filenames: false
        args:
          - -c
          - |
            if command -v rg >/dev/null 2>&1; then
              matches=$(rg --no-heading --line-number --glob '*.{py,js,ts,go,yml,yaml}' --iglob '!node_modules/**' --iglob '!.venv/**' --iglob '!site/**' --iglob '!*.pre-commit-config.yaml' "TODO|FIXME" || true)
            else
              matches=$(find . -type f \( -name "*.py" -o -name "*.js" -o -name "*.ts" -o -name "*.go" -o -name "*.yml" -o -name "*.yaml" \) ! -path "*/node_modules/*" ! -path "*/.venv/*" ! -path "*/site/*" ! -name ".pre-commit-config.yaml" -exec grep -Hn "TODO\\|FIXME" {} \; 2>/dev/null)
            fi
            matches=$(echo "$matches" | grep -v "pragma: allowlist todo" | head -20)
            if [[ -n "$matches" ]]; then
              echo "Inline tasks detected; create a GitHub Issue instead of a comment."
              echo "$matches"
              exit 1
            fi

      - id: no-emoji-in-files
        name: "Docs: validate no emoji"
        entry: python3 scripts/validate-no-emoji.py
        language: system
        files: \.(md|txt)$
        exclude: |
          (?x)^(
            node_modules/.*|
            \.venv/.*|
            site/.*|
            data/.*|
            \.config-backup/.*
          )$
