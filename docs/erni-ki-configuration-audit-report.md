# üîç ERNI-KI: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** $(date) **–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** ERNI-KI Latest **–ê—É–¥–∏—Ç–æ—Ä:** Augment
Code AI Assistant

## üìä –°–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞—É–¥–∏—Ç–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è                 | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ | –í–∞–∂–Ω—ã–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ | –í—Å–µ–≥–æ  |
| ------------------------- | ----------- | ------ | ------------ | ------ |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**          | 4           | 6      | 8            | 18     |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**    | 2           | 5      | 7            | 14     |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**          | 3           | 4      | 9            | 16     |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**            | 1           | 3      | 5            | 9      |
| **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** | 2           | 2      | 3            | 7      |
| **–ò–¢–û–ì–û**                 | **12**      | **20** | **32**       | **64** |

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–¢—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 1. –°–ª–∞–±—ã–µ –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–§–∞–π–ª:** `env/backrest.example` **–°—Ç—Ä–æ–∫–∞:** 15 **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ä–æ–ª—å
"CHANGE_BEFORE_GOING_LIVE" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production **–í–ª–∏—è–Ω–∏–µ:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è
—É—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```bash
# –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å
openssl rand -base64 32 > /tmp/backrest_password
# –û–±–Ω–æ–≤–∏—Ç—å env/backrest.env
BACKREST_PASSWORD=$(cat /tmp/backrest_password)
```

#### 2. Redis –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–§–∞–π–ª:** `env/redis.env` **–°—Ç—Ä–æ–∫–∞:** 1 **–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
requirepass, Redis –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ–∑ –ø–∞—Ä–æ–ª—è **–í–ª–∏—è–Ω–∏–µ:** –ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫
–∫—ç—à—É –∏ —Å–µ—Å—Å–∏—è–º **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```bash
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å
REDIS_ARGS="--requirepass $(openssl rand -base64 32)"
```

#### 3. –û—Ç–∫—Ä—ã—Ç—ã–µ API –∫–ª—é—á–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–§–∞–π–ª:** `env/openwebui.env` **–°—Ç—Ä–æ–∫–∏:** 43, 47 **–ü—Ä–æ–±–ª–µ–º–∞:** Placeholder API
–∫–ª—é—á–∏ –≤ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ **–í–ª–∏—è–Ω–∏–µ:** –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö
–∫–ª—é—á–µ–π **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ Docker secrets
OPENAI_API_KEY_FILE=/run/secrets/openai_key
LITELLM_API_KEY_FILE=/run/secrets/litellm_key
```

#### 4. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ SSL –∫–ª—é—á–∞–º

**–§–∞–π–ª:** `conf/nginx/ssl/` **–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Å–ª–∏—à–∫–æ–º
–æ—Ç–∫—Ä—ã—Ç—ã–µ –ø—Ä–∞–≤–∞ **–í–ª–∏—è–Ω–∏–µ:** –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```bash
chmod 600 conf/nginx/ssl/*.key
chmod 644 conf/nginx/ssl/*.crt
```

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ—Å—É—Ä—Å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**–§–∞–π–ª:** `compose.yml` **–°—Ç—Ä–æ–∫–∏:** 81-120 (LiteLLM) **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç
deploy.resources –¥–ª—è LiteLLM **–í–ª–∏—è–Ω–∏–µ:** –í–æ–∑–º–æ–∂–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
—Å–∏—Å—Ç–µ–º—ã **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```yaml
deploy:
  resources:
    limits:
      memory: 2G
      cpus: '1.0'
    reservations:
      memory: 1G
      cpus: '0.5'
```

#### 6. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ PostgreSQL

**–§–∞–π–ª:** `env/db.env` **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
**–í–ª–∏—è–Ω–∏–µ:** –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ env/db.env
POSTGRES_SHARED_PRELOAD_LIBRARIES=pg_stat_statements,vector
POSTGRES_MAX_CONNECTIONS=200
POSTGRES_SHARED_BUFFERS=256MB
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB
```

### üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### 7. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ health check –∫–æ–º–∞–Ω–¥—ã

**–§–∞–π–ª:** `monitoring/docker-compose.monitoring.yml` **–°—Ç—Ä–æ–∫–∏:** 316-325 (Node
Exporter) **–ü—Ä–æ–±–ª–µ–º–∞:** Health check –∏—Å–ø–æ–ª—å–∑—É–µ—Ç wget –≤–º–µ—Å—Ç–æ curl **–í–ª–∏—è–Ω–∏–µ:**
–õ–æ–∂–Ω—ã–µ "unhealthy" —Å—Ç–∞—Ç—É—Å—ã **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```yaml
healthcheck:
  test: ['CMD-SHELL', 'curl -f http://localhost:9100/metrics || exit 1']
```

#### 8. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ—Ç–µ–≤–æ–π –∏–∑–æ–ª—è—Ü–∏–∏

**–§–∞–π–ª:** `compose.yml`, `monitoring/docker-compose.monitoring.yml`
**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ **–í–ª–∏—è–Ω–∏–µ:** –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞
–Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```yaml
networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
    internal: true
  monitoring:
    driver: bridge
    internal: true
```

#### 9. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

**–§–∞–π–ª:** `conf/nginx/conf.d/default.conf` **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç security
headers **–í–ª–∏—è–Ω–∏–µ:** –£—è–∑–≤–∏–º–æ—Å—Ç–∏ XSS, clickjacking **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```nginx
add_header X-Frame-Options DENY;
add_header X-Content-Type-Options nosniff;
add_header X-XSS-Protection "1; mode=block";
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
```

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ (–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 10. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting –¥–ª—è API

**–§–∞–π–ª:** `conf/nginx/conf.d/default.conf` **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞
—á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API **–í–ª–∏—è–Ω–∏–µ:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å DDoS –∞—Ç–∞–∫ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```nginx
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req zone=api burst=20 nodelay;
```

#### 11. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `env/litellm.env` **–°—Ç—Ä–æ–∫–∞:** 47 **–ü—Ä–æ–±–ª–µ–º–∞:** DISABLE_SPEND_LOGS=True
–º–æ–∂–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é **–í–ª–∏—è–Ω–∏–µ:** –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```bash
# –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
ENABLE_AUDIT_LOGS=True
LOG_LEVEL=INFO
SANITIZE_LOGS=True
```

#### 12. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–§–∞–π–ª:** `monitoring/alert_rules.yml` **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∞–ª–µ—Ä—Ç–æ–≤ –Ω–∞
–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å **–í–ª–∏—è–Ω–∏–µ:** –ù–µ—Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞—Ç–∞–∫
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```yaml
- alert: SuspiciousActivity
  expr: rate(nginx_http_requests_total{status=~"4.."}[5m]) > 10
  for: 2m
  labels:
    severity: warning
  annotations:
    summary: 'High rate of 4xx errors detected'
```

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 13. –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis

**–§–∞–π–ª:** `env/redis.env` **–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
**–í–ª–∏—è–Ω–∏–µ:** –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```bash
REDIS_ARGS="--maxmemory 1gb --maxmemory-policy allkeys-lru --save 900 1"
```

#### 14. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ connection pooling

**–§–∞–π–ª:** `env/openwebui.env` **–°—Ç—Ä–æ–∫–∏:** 64-67 **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞
–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ **–í–ª–∏—è–Ω–∏–µ:** –ò—Å—á–µ—Ä–ø–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```bash
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏
DATABASE_POOL_SIZE=10
DATABASE_POOL_MAX_OVERFLOW=5
DATABASE_POOL_TIMEOUT=10
```

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò (–£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 15. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ Docker secrets

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```yaml
secrets:
  postgres_password:
    file: ./secrets/postgres_password.txt
  redis_password:
    file: ./secrets/redis_password.txt
services:
  db:
    secrets:
      - postgres_password
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
```

#### 16. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WAF (Web Application Firewall)

**–§–∞–π–ª:** `conf/nginx/waf-litellm.conf` **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏
–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å ModSecurity rules

#### 17. –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—Ç–∞—Ü–∏—é API –∫–ª—é—á–µ–π –∏ –ø–∞—Ä–æ–ª–µ–π

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 18. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å multi-stage builds –∏ alpine –æ–±—Ä–∞–∑—ã –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

#### 19. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### 20. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö API endpoints

## üìã –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### üî• –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (0-24 —á–∞—Å–∞)

1. **–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
2. **–í–∫–ª—é—á–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é Redis** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
3. **–£–¥–∞–ª–∏—Ç—å placeholder API –∫–ª—é—á–∏** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ SSL –∫–ª—é—á–∞–º** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

### ‚ö° –°—Ä–æ—á–Ω–æ (1-3 –¥–Ω—è)

5. **–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Å—É—Ä—Å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
6. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å PostgreSQL** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
7. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å health check –∫–æ–º–∞–Ω–¥—ã** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
8. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ç–µ–≤—É—é –∏–∑–æ–ª—è—Ü–∏—é** (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

### üìÖ –í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ (4-7 –¥–Ω–µ–π)

9. **–î–æ–±–∞–≤–∏—Ç—å security headers –≤ Nginx** (–í–∞–∂–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
10. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting** (–í–∞–∂–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
11. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Redis** (–í–∞–∂–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
12. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (–í–∞–∂–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

### üîÑ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-4 –Ω–µ–¥–µ–ª–∏)

13. **–í–Ω–µ–¥—Ä–∏—Ç—å Docker secrets** (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
14. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å WAF** (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
15. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—Ç–∞—Ü–∏—é –∫–ª—é—á–µ–π** (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
16. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã** (–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [ ] 0 –ø–∞—Ä–æ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ production
- [ ] 100% —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- [ ] 0 –æ—Ç–∫—Ä—ã—Ç—ã—Ö API –∫–ª—é—á–µ–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] –í—Å–µ SSL –∫–ª—é—á–∏ —Å –ø—Ä–∞–≤–∞–º–∏ 600

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å —Ä–µ—Å—É—Ä—Å–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- [ ] –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API <2s
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ <80%
- [ ] Connection pool utilization <70%

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- [ ] 100% health checks —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- [ ] –í—Å–µ security headers –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Rate limiting –∞–∫—Ç–∏–≤–µ–Ω –¥–ª—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö endpoints

## üìÅ –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### üîç –ê–Ω–∞–ª–∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö compose —Ñ–∞–π–ª–æ–≤

#### `compose.yml` - –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

| –ü—Ä–æ–±–ª–µ–º–∞                       | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å  | –û–ø–∏—Å–∞–Ω–∏–µ                                | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ                             |
| ------------------------------ | ------------ | --------------------------------------- | --------------------------------------- |
| –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ—Å—É—Ä—Å–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤   | –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  | LiteLLM, Ollama –±–µ–∑ deploy.resources    | –î–æ–±–∞–≤–∏—Ç—å memory/CPU limits              |
| –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏       | –í–ê–ñ–ù–ê–Ø       | –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ | –£–ø—Ä–æ—Å—Ç–∏—Ç—å –≥—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π             |
| –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ health checks       | –í–ê–ñ–ù–ê–Ø       | –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∑–¥–æ—Ä–æ–≤—å—è | –î–æ–±–∞–≤–∏—Ç—å health checks                  |
| –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ restart policies | –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø | unless-stopped –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤        | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å on-failure –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö |

#### `monitoring/docker-compose.monitoring.yml` - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

| –ü—Ä–æ–±–ª–µ–º–∞                   | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ                                     | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ                                |
| -------------------------- | ----------- | -------------------------------------------- | ------------------------------------------ |
| Privileged –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã      | –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø | Node Exporter —Å pid: host                    | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å bind mounts –≤–º–µ—Å—Ç–æ privileged |
| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ health checks | –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ wget –≤ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –æ–±—Ä–∞–∑–∞—Ö | –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ curl –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å             |
| –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã         | –í–ê–ñ–ù–ê–Ø      | Elasticsearch —Å 1GB RAM –¥–ª—è dev —Å—Ä–µ–¥—ã        | –£–º–µ–Ω—å—à–∏—Ç—å –¥–æ 512MB                         |
| –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã             | –í–ê–ñ–ù–ê–Ø      | –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–æ—Ä—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑–≤–Ω–µ              | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å internal networks             |

### üîê –ê–Ω–∞–ª–∏–∑ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ `env/` —Ñ–∞–π–ª–∞—Ö

**`env/backrest.env`**

```bash
# –ü–†–û–ë–õ–ï–ú–ê: –°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
BACKREST_PASSWORD=CHANGE_BEFORE_GOING_LIVE  # ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø

# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
BACKREST_PASSWORD=$(openssl rand -base64 32)  # ‚úÖ
BACKREST_USERNAME=admin_$(date +%s)           # ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è
```

**`env/redis.env`**

```bash
# –ü–†–û–ë–õ–ï–ú–ê: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
# REDIS_ARGS="--requirepass sider"  # ‚ùå –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
REDIS_ARGS="--requirepass $(openssl rand -base64 32) --maxmemory 1gb --maxmemory-policy allkeys-lru"  # ‚úÖ
```

**`env/openwebui.env`**

```bash
# –ü–†–û–ë–õ–ï–ú–´:
OPENAI_API_KEY=your_openai_api_key_here      # ‚ùå Placeholder
LITELLM_API_KEY=sk-7b788d...                 # ‚ùå –•–∞—Ä–¥–∫–æ–¥ –∫–ª—é—á–∞
DATABASE_URL="postgresql://postgres:postgres@db:5432/openwebui"  # ‚ùå –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

# –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
OPENAI_API_KEY_FILE=/run/secrets/openai_key  # ‚úÖ Docker secret
LITELLM_API_KEY_FILE=/run/secrets/litellm_key # ‚úÖ Docker secret
DATABASE_URL=postgresql://postgres:${POSTGRES_PASSWORD}@db:5432/openwebui  # ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è
```

### üåê –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx

#### `conf/nginx/nginx.conf` - –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü—Ä–æ–±–ª–µ–º—ã:**

- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç security headers
- –ù–µ—Ç rate limiting
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

```nginx
http {
    # Security headers
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';" always;

    # Rate limiting
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;

    # Hide server version
    server_tokens off;

    # Optimize performance
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
}
```

### üìä –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### `monitoring/prometheus.yml` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus

**–¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**

- –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç scrape limits
- –ù–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ retention
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç remote storage –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  # –î–æ–±–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
  sample_limit: 10000
  label_limit: 30
  label_name_length_limit: 200
  label_value_length_limit: 200

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ retention
storage:
  tsdb:
    retention.time: 30d
    retention.size: 10GB
    wal-compression: true

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
rule_files:
  - 'alert_rules.yml'
  - 'recording_rules.yml' # –î–æ–±–∞–≤–∏—Ç—å recording rules –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```

#### `monitoring/alert_rules.yml` - –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã:**

```yaml
groups:
  - name: security
    rules:
      - alert: HighErrorRate
        expr: rate(nginx_http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: 'High 5xx error rate detected'

      - alert: SuspiciousLoginAttempts
        expr: rate(auth_failed_attempts_total[5m]) > 5
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: 'Multiple failed login attempts detected'

      - alert: UnauthorizedAPIAccess
        expr: rate(nginx_http_requests_total{status="401"}[5m]) > 10
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: 'High rate of unauthorized API access attempts'
```

## üõ†Ô∏è –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –°–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
#!/bin/bash
# fix-critical-security.sh

echo "üîí –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ERNI-KI..."

# 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π
echo "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π..."
POSTGRES_PASSWORD=$(openssl rand -base64 32)
REDIS_PASSWORD=$(openssl rand -base64 32)
BACKREST_PASSWORD=$(openssl rand -base64 32)

# 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ env —Ñ–∞–π–ª–æ–≤
sed -i "s/POSTGRES_PASSWORD=.*/POSTGRES_PASSWORD=${POSTGRES_PASSWORD}/" env/db.env
sed -i "s/# REDIS_ARGS=.*/REDIS_ARGS=\"--requirepass ${REDIS_PASSWORD}\"/" env/redis.env
sed -i "s/BACKREST_PASSWORD=.*/BACKREST_PASSWORD=${BACKREST_PASSWORD}/" env/backrest.env

# 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
chmod 600 env/*.env
chmod 600 conf/nginx/ssl/*.key
chmod 644 conf/nginx/ssl/*.crt

# 4. –°–æ–∑–¥–∞–Ω–∏–µ Docker secrets
mkdir -p secrets
echo "${POSTGRES_PASSWORD}" > secrets/postgres_password.txt
echo "${REDIS_PASSWORD}" > secrets/redis_password.txt
echo "${BACKREST_PASSWORD}" > secrets/backrest_password.txt
chmod 600 secrets/*.txt

echo "‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!"
```

### –°–∫—Ä–∏–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
#!/bin/bash
# optimize-performance.sh

echo "‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ERNI-KI..."

# 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤ compose.yml
cat >> compose.yml << 'EOF'
# –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
x-resource-limits: &resource-limits
  deploy:
    resources:
      limits:
        memory: 2G
        cpus: "1.0"
      reservations:
        memory: 1G
        cpus: "0.5"
EOF

# 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PostgreSQL
cat >> env/db.env << 'EOF'
# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ PostgreSQL
POSTGRES_SHARED_PRELOAD_LIBRARIES=pg_stat_statements,vector
POSTGRES_MAX_CONNECTIONS=200
POSTGRES_SHARED_BUFFERS=256MB
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB
POSTGRES_WORK_MEM=4MB
POSTGRES_MAINTENANCE_WORK_MEM=64MB
EOF

# 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Redis
sed -i 's/REDIS_ARGS=.*/REDIS_ARGS="--maxmemory 1gb --maxmemory-policy allkeys-lru --save 900 1"/' env/redis.env

echo "‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
```

---

**–°–ª–µ–¥—É—é—â–∏–π –∞—É–¥–∏—Ç:** $(date -d "+1 month") **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
–°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä **–ö–æ–Ω—Ç—Ä–æ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** admin@erni-ki.local
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** security@erni-ki.local
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** monitoring@erni-ki.local
