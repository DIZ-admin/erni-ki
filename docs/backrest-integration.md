# Backrest Integration для ERNI-KI

## Обзор

Система резервного копирования ERNI-KI использует Backrest для автоматического создания резервных копий критически важных данных.

## Конфигурация

### Репозиторий
- **Тип**: Локальное хранилище
- **Путь**: `.config-backup/`
- **Шифрование**: AES-256 (пароль в `conf/backrest/repo-password.txt`)

### Планы резервного копирования

#### Ежедневные резервные копии
- **Расписание**: 01:00 каждый день
- **Хранение**: 7 дней
- **Содержимое**: env/, conf/, data/postgres/, data/openwebui/, data/ollama/

#### Еженедельные резервные копии  
- **Расписание**: 02:00 каждое воскресенье
- **Хранение**: 4 недели
- **Содержимое**: env/, conf/, data/postgres/, data/openwebui/, data/ollama/

## Мониторинг

### Интеграция с системой мониторинга
- Webhook: `scripts/backrest-webhook.sh`
- Логи: `logs/backrest-notifications.log`
- Системный журнал: `journalctl -t erni-ki-backrest`

### Уведомления
- Успешные резервные копии логируются
- Ошибки отправляются в систему мониторинга
- Интеграция с rate limiting мониторингом

## API Endpoints

- **Конфигурация**: `POST /v1.Backrest/GetConfig`
- **Операции**: `POST /v1.Backrest/GetOperations`
- **Запуск резервного копирования**: `POST /v1.Backrest/Backup`

## Восстановление

Для восстановления данных используйте веб-интерфейс Backrest:
```
http://localhost:9898
```

## Безопасность

- Пароль репозитория хранится в зашифрованном виде
- Доступ к API ограничен localhost
- Резервные копии создаются с правами root
