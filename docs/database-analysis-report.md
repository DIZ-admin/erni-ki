# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö ERNI-KI

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 04 –∏—é–ª—è 2025
**–í–µ—Ä—Å–∏—è –æ—Ç—á–µ—Ç–∞:** 1.0
**–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:** –í—Å–µ 14 —Å–µ—Ä–≤–∏—Å–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç (healthy)

## üìã –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ

–°–∏—Å—Ç–µ–º–∞ ERNI-KI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö —Å PostgreSQL –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –¥–ª—è RAG-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏. –í—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å –≤—ã—è–≤–ª–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | –¢–∏–ø | –í–µ—Ä—Å–∏—è | –°—Ç–∞—Ç—É—Å | –†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ |
|-------------|-----|--------|--------|----------------|
| **PostgreSQL** | –†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –ë–î | pg15 + pgvector | ‚úÖ Healthy | –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö |
| **Redis** | In-memory –ë–î | redis-stack:latest | ‚úÖ Healthy | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏ |
| **PGVector** | –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PostgreSQL | ‚úÖ Active | RAG –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ |
| **SQLite** | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ë–î | –†–∞–∑–ª–∏—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ | ‚úÖ Active | –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–æ–≤ |

### –°—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

```mermaid
graph TB
    subgraph "–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å"
        UI[OpenWebUI]
        API[API Gateway/Nginx]
    end

    subgraph "–°–µ—Ä–≤–∏—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å"
        AUTH[Auth Service]
        SEARCH[SearXNG]
        OLLAMA[Ollama]
        MCP[MCP Server]
        DOCLING[Docling]
        TIKA[Tika]
        BACKREST[Backrest]
    end

    subgraph "–£—Ä–æ–≤–µ–Ω—å –¥–∞–Ω–Ω—ã—Ö"
        PG[(PostgreSQL + PGVector)]
        REDIS[(Redis Stack)]
        SQLITE1[(SQLite - Backrest)]
        SQLITE2[(SQLite - Ollama)]
    end

    UI --> API
    API --> AUTH
    API --> UI

    UI --> PG
    UI --> REDIS
    SEARCH --> REDIS
    MCP --> PG
    BACKREST --> SQLITE1
    OLLAMA --> SQLITE2

    AUTH -.-> PG
    DOCLING -.-> PG
    TIKA -.-> PG

    PG --> |–í–µ–∫—Ç–æ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ| PG
    REDIS --> |–ö—ç—à –ø–æ–∏—Å–∫–∞| SEARCH
```

## ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### PostgreSQL (–û—Å–Ω–æ–≤–Ω–∞—è –ë–î)

**Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
db:
  image: pgvector/pgvector:pg15
  env_file: env/db.env
  volumes:
    - ./data/postgres:/var/lib/postgresql/data
  healthcheck:
    test: ["CMD-SHELL", "pg_isready -d ${POSTGRES_DB} -U ${POSTGRES_USER}"]
    interval: 30s
    timeout: 5s
    retries: 5
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `POSTGRES_DB=openwebui` - –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `POSTGRES_USER=postgres` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
- `POSTGRES_PASSWORD=aEnbxS4MrXqzurHNGxkcEgCBm` - –ü–∞—Ä–æ–ª—å (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –í–∫–ª—é—á–µ–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvector –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ checkpoint –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- Healthcheck –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

### Redis (–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)

**Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
redis:
  image: redis/redis-stack:latest
  env_file: env/redis.env
  volumes:
    - ./data/redis:/data
  healthcheck:
    test: ["CMD-SHELL", "redis-cli ping | grep PONG"]
    interval: 30s
    timeout: 3s
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `RI_PROXY_PATH=redis` - –ü—É—Ç—å –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–∞—Ä–æ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —á–∞—Å
- –í–∫–ª—é—á–µ–Ω—ã –º–æ–¥—É–ª–∏ RedisSearch –∏ RedisJSON
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ./data/redis

## üìä –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ –∫ –ë–î

| –°–µ—Ä–≤–∏—Å | PostgreSQL | Redis | –õ–æ–∫–∞–ª—å–Ω–∞—è –ë–î |
|--------|------------|-------|--------------|
| **OpenWebUI** | ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | ‚ùå | ‚ùå |
| **SearXNG** | ‚ùå | ‚úÖ –ö—ç—à –ø–æ–∏—Å–∫–∞ | ‚ùå |
| **MCP Server** | ‚úÖ –ß–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥ | ‚ùå | ‚ùå |
| **Auth Service** | ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | ‚ùå | ‚ùå |
| **Backrest** | ‚ùå | ‚ùå | ‚úÖ SQLite |
| **Ollama** | ‚ùå | ‚ùå | ‚úÖ –ú–æ–¥–µ–ª–∏ |

### –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã OpenWebUI:**
- `user` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- `chat` - –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤
- `message` - –°–æ–æ–±—â–µ–Ω–∏—è
- `document` - –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- `document_chunk` - –í–µ–∫—Ç–æ—Ä–Ω—ã–µ —á–∞–Ω–∫–∏ –¥–ª—è RAG
- `config` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
- `model` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª—è—Ö

**–¢–∞–±–ª–∏—Ü—ã LiteLLM (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è):**
- `LiteLLM_*` - 28 —Ç–∞–±–ª–∏—Ü –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è API
- –í–∫–ª—é—á–∞–µ—Ç –∞—É–¥–∏—Ç, –±—é–¥–∂–µ—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –º–æ–¥–µ–ª–∏

### –û–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

**PostgreSQL:**
- 53 —Ç–∞–±–ª–∏—Ü—ã –≤ —Å—Ö–µ–º–µ public
- –ê–∫—Ç–∏–≤–Ω—ã–µ checkpoint –æ–ø–µ—Ä–∞—Ü–∏–∏
- –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è RAG

**Redis:**
- 738 –∫–ª—é—á–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —á–∞—Å
- –ö—ç—à SearXNG –∑–∞–ø—Ä–æ—Å–æ–≤

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ –ë–î

```bash
# –†–µ–∑—É–ª—å—Ç–∞—Ç docker-compose ps
erni-ki-db-1      pgvector/pgvector:pg15    Up 6 hours (healthy)
erni-ki-redis-1   redis/redis-stack:latest  Up 6 hours (healthy)
```

### –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

**PostgreSQL - –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
```
ERROR: column "api_key" does not exist at character 26
ERROR: operator does not exist: json ~~ unknown at character 33
ERROR: invalid input syntax for type integer: "rag.embedding.model"
```

**Redis - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ:**
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

**Healthcheck —Å—Ç–∞—Ç—É—Å:**
- PostgreSQL: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30—Å
- Redis: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30—Å
- –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

1. **–û—à–∏–±–∫–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ PostgreSQL**
   - –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
   - –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ–º —Ç–∏–ø–æ–≤
   - –í—Ä–µ–º—è: 2-4 —á–∞—Å–∞

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä–æ–ª–µ–π Redis**
   - –ü—Ä–æ–±–ª–µ–º–∞: Redis –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å REDIS_ARGS="--requirepass"
   - –í—Ä–µ–º—è: 1 —á–∞—Å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

1. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PostgreSQL**
   ```sql
   -- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   shared_buffers = 256MB
   effective_cache_size = 1GB
   work_mem = 4MB
   maintenance_work_mem = 64MB
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Redis**
   ```
   maxmemory 512mb
   maxmemory-policy allkeys-lru
   save 900 1 300 10 60 10000
   ```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

1. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**
   - –í–∫–ª—é—á–∏—Ç—å SSL –¥–ª—è PostgreSQL
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å TLS –¥–ª—è Redis

2. **–†–æ—Ç–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª–µ–π –∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ secrets management

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3)

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Backrest:**
- ‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã (7 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è)
- ‚úÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã (4 –Ω–µ–¥–µ–ª–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è)
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ .config-backup/

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –î–æ–±–∞–≤–∏—Ç—å —É–¥–∞–ª–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3/B2)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–∑ –≤ –º–µ—Å—è—Ü
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –±—ç–∫–∞–ø–æ–≤

## üìà –ü–ª–∞–Ω –ø–æ—ç—Ç–∞–ø–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –¥–Ω—è)
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SQL-–æ—à–∏–±–æ–∫ –≤ PostgreSQL
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Redis
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (3-5 –¥–Ω–µ–π)
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ PostgreSQL
2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –§–∞–∑–∞ 3: –£–ª—É—á—à–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (1-2 –Ω–µ–¥–µ–ª–∏)
1. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ SSL/TLS
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ø–∞—Ä–æ–ª–µ–π
3. –ê—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –§–∞–∑–∞ 4: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ (1 –Ω–µ–¥–µ–ª—è)
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### OpenWebUI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL:**
```env
DATABASE_URL="postgresql://postgres:aEnbxS4MrXqzurHNGxkcEgCBm@db:5432/openwebui"
PGVECTOR_DB_URL=postgresql://postgres:aEnbxS4MrXqzurHNGxkcEgCBm@db:5432/openwebui
VECTOR_DB=pgvector
```

**RAG –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```env
RAG_EMBEDDING_ENGINE=ollama
RAG_EMBEDDING_MODEL=nomic-embed-text:latest
RAG_OLLAMA_BASE_URL=http://ollama:11434
RAG_WEB_SEARCH_ENGINE=searxng
RAG_WEB_SEARCH_RESULT_COUNT=6
```

### SearXNG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redis

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis:**
```env
SEARXNG_REDIS_URL=redis://redis:6379/1
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Redis: 1 (–æ—Ç–¥–µ–ª—å–Ω–∞—è –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
- –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### MCP Server –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL:**
```json
{
  "mcpServers": {
    "postgres": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-postgres",
        "postgresql://postgres:postgres@db/openwebui"
      ]
    }
  }
}
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### PostgreSQL –º–µ—Ç—Ä–∏–∫–∏

**Checkpoint –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∑–∞–ø–∏—Å–∏: 4-96 –±—É—Ñ–µ—Ä–æ–≤
- –í—Ä–µ–º—è –∑–∞–ø–∏—Å–∏: 0.1-12.5 —Å–µ–∫—É–Ω–¥
- –û—Ü–µ–Ω–æ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä WAL: 754 KB

**–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö:**
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LIKE —Å JSON –ø–æ–ª—è–º–∏
2. –ü–æ–ø—ã—Ç–∫–∏ –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–ª–æ–Ω–∫–∞–º
3. –û—à–∏–±–∫–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤

### Redis –º–µ—Ç—Ä–∏–∫–∏

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ: –∫–∞–∂–¥—ã–π —á–∞—Å
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π: 738
- –†–∞–∑–º–µ—Ä RDB —Ñ–∞–π–ª–∞: —Å—Ç–∞–±–∏–ª—å–Ω—ã–π
- Fork CoW: 0 MB (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)

## üõ°Ô∏è –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –¢–µ–∫—É—â–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

1. **Redis –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
   - –†–∏—Å–∫: –°—Ä–µ–¥–Ω–∏–π (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å)
   - –°—Ç–∞—Ç—É—Å: –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

2. **–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–∞—Ä–æ–ª–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –†–∏—Å–∫: –í—ã—Å–æ–∫–∏–π
   - –°—Ç–∞—Ç—É—Å: –¢—Ä–µ–±—É–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ SSL –¥–ª—è –ë–î**
   - –†–∏—Å–∫: –°—Ä–µ–¥–Ω–∏–π
   - –°—Ç–∞—Ç—É—Å: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ env/redis.env
REDIS_ARGS="--requirepass $(openssl rand -hex 32)"

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é SearXNG
SEARXNG_REDIS_URL=redis://:password@redis:6379/1
```

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker secrets
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL/TLS –¥–ª—è –≤—Å–µ—Ö –ë–î
- –†–µ–≥—É–ª—è—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### –¢–µ–∫—É—â–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**Healthcheck –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```yaml
# PostgreSQL
healthcheck:
  test: ["CMD-SHELL", "pg_isready -d ${POSTGRES_DB} -U ${POSTGRES_USER}"]
  interval: 30s
  timeout: 5s
  retries: 5

# Redis
healthcheck:
  test: ["CMD-SHELL", "redis-cli ping | grep PONG"]
  interval: 30s
  timeout: 3s
  retries: 5
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

**PostgreSQL:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
- Checkpoint —á–∞—Å—Ç–æ—Ç–∞

**Redis:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- Hit/miss ratio –∫—ç—à–∞
- –†–∞–∑–º–µ—Ä RDB —Ñ–∞–π–ª–∞

## üîÑ –ü—Ä–æ—Ü–µ–¥—É—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

### Backrest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü–æ–ª–∏—Ç–∏–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ: 7 –¥–Ω–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ: 4 –Ω–µ–¥–µ–ª–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: `.config-backup/`

**–í–∫–ª—é—á–µ–Ω–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
- `env/` - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `conf/` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `data/postgres/` - –î–∞–Ω–Ω—ã–µ PostgreSQL
- `data/openwebui/` - –î–∞–Ω–Ω—ã–µ OpenWebUI
- `data/ollama/` - –ú–æ–¥–µ–ª–∏ Ollama

### –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose stop db redis openwebui

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ Backrest
# (—á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ –ø–æ—Ä—Ç—É 9898)

# 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d db redis
sleep 30
docker-compose up -d openwebui

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
docker-compose exec db psql -U postgres -d openwebui -c "SELECT COUNT(*) FROM user;"
```

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** –ê–ª—å—Ç—ç–æ–Ω –®—É–ª—å—Ü (Tech Lead)
**–î–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∞—É–¥–∏—Ç–∞:** 04 –∞–≤–≥—É—Å—Ç–∞ 2025
**–°—Ç–∞—Ç—É—Å –æ—Ç—á–µ—Ç–∞:** –ì–æ—Ç–æ–≤ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

---

*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π –∞–Ω–∞–ª–∏–∑–∞ ERNI-KI*
*–í–µ—Ä—Å–∏—è: 1.0 | –î–∞—Ç–∞: 04.07.2025*
