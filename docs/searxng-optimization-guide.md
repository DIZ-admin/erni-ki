# üîç SearXNG Optimization Guide –¥–ª—è ERNI-KI

> **–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.0
> **–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-07-15
> **–°—Ç–∞—Ç—É—Å:** Production Ready

## üìã –û–±–∑–æ—Ä –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é SearXNG –≤ –ø—Ä–æ–µ–∫—Ç–µ ERNI-KI, –≤–∫–ª—é—á–∞—é—â—É—é —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
./scripts/optimize-searxng.sh

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
./scripts/test-searxng-integration.sh
```

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### ‚úÖ –£—Å–∏–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- **–£–¥–∞–ª–µ–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ capabilities**: `CHOWN`, `DAC_OVERRIDE`
- **–î–æ–±–∞–≤–ª–µ–Ω—ã security options**: `no-new-privileges:true`
- **–í–∫–ª—é—á–µ–Ω read-only —Ä–µ–∂–∏–º** —Å tmpfs –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã tmpfs**: `/tmp`, `/var/cache/searxng`, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫—ç—à

#### ‚úÖ –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–ª—é—á–∞ (32 –±–∞–π—Ç–∞ hex)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è** –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑** `${SEARXNG_SECRET}`

#### ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```yaml
server:
  limiter: true              # –í–∫–ª—é—á–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
  image_proxy: true          # –í–∫–ª—é—á–µ–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  public_instance: false     # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º
```

#### ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```yaml
default_http_headers:
  X-Content-Type-Options: nosniff
  X-Download-Options: noopen
  X-Robots-Tag: noindex, nofollow
  Referrer-Policy: no-referrer
  X-Frame-Options: DENY
  X-XSS-Protection: "1; mode=block"
  Strict-Transport-Security: "max-age=31536000; includeSubDomains"
```

### 2. Nginx Optimization

#### ‚úÖ Upstream –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```nginx
upstream searxngUpstream {
  server searxng:8080 max_fails=3 fail_timeout=30s weight=1;
  keepalive 16;
  keepalive_requests 100;
  keepalive_timeout 60s;
}
```

#### ‚úÖ Rate Limiting
```nginx
# –ó–æ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
limit_req_zone $binary_remote_addr zone=searxng_limit:10m rate=10r/m;
limit_req_zone $binary_remote_addr zone=general_limit:10m rate=100r/m;
limit_req_zone $binary_remote_addr zone=auth_limit:10m rate=20r/m;

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è SearXNG
location /searxng {
  limit_req zone=searxng_limit burst=5 nodelay;
  limit_req_status 429;
  # ...
}
```

#### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–µ proxy –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–¢–∞–π–º–∞—É—Ç—ã**: connect=5s, send=10s, read=30s
- **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è**: –≤–∫–ª—é—á–µ–Ω–∞ —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
- **HTTP/1.1**: –¥–ª—è keepalive —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Health check endpoint**: `/searxng/healthz`

### 3. uWSGI Optimization

#### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```ini
# HTTP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
http-keepalive = true
http-auto-chunked = true
buffer-size = 16384
post-buffering = 8192

# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
cheaper = 2
cheaper-initial = 2
cheaper-step = 1
cheaper-algo = busyness
cheaper-overload = 30
```

#### ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```ini
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏
stats = 127.0.0.1:9191
stats-http = true
memory-report = true
log-slow = 1000
```

#### ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```ini
# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
static-expires = /* 86400
static-gzip-all = true
static-gzip-ext = .js .css .html .txt .xml .json

# –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—ç—à
cache2 = name=searxngcache,items=2000,blocks=2000,blocksize=4096,bitmap=1
```

## üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### env/searxng.env
```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SEARXNG_HOST=0.0.0.0:8080
SEARXNG_PORT=8080
SEARXNG_BIND_ADDRESS=0.0.0.0

# Redis
SEARXNG_REDIS_URL=redis://redis:6379/1

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
SEARXNG_SECRET=<auto-generated-32-byte-hex>
SEARXNG_LIMITER=true
SEARXNG_IMAGE_PROXY=true
SEARXNG_PUBLIC_INSTANCE=false

# URL
SEARXNG_BASE_URL=https://<domain-name>/searxng

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
SEARXNG_DEBUG=false
SEARXNG_HTTP_PROTOCOL_VERSION=1.1
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenWebUI

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
# –í env/openwebui.env
RAG_WEB_SEARCH_ENGINE=searxng
RAG_WEB_SEARCH_RESULT_COUNT=6
RAG_WEB_SEARCH_CONCURRENT_REQUESTS=10
SEARXNG_QUERY_URL=http://searxng:8080/search?q=<query>
WEB_SEARCH_ENGINE=searxng
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```bash
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ OpenWebUI
docker-compose exec openwebui curl -f http://searxng:8080/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose exec openwebui env | grep SEARXNG
```

## üè• Health Checks

### Docker Compose
```yaml
healthcheck:
  test: ["CMD-SHELL", "curl --fail http://localhost:8080/healthz || curl --fail http://localhost:8080/ || exit 1"]
  interval: 30s
  timeout: 5s
  retries: 3
  start_period: 15s
```

### Nginx Health Check
```nginx
location /searxng/healthz {
  access_log off;
  proxy_pass http://searxngUpstream/healthz;
  proxy_connect_timeout 1s;
  proxy_send_timeout 1s;
  proxy_read_timeout 1s;
}
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### uWSGI Stats
- **URL**: http://localhost:9191
- **–§–æ—Ä–º–∞—Ç**: HTTP JSON API
- **–ú–µ—Ç—Ä–∏–∫–∏**: requests, workers, memory, response times

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```ini
# –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
disable-logging = false
log-5xx = true
log-4xx = true
log-slow = 1000
log-date = true
```

### Docker Logs
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
docker-compose logs -f searxng

# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
docker-compose logs searxng | grep "slow"
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
```bash
# –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
./scripts/test-searxng-integration.sh

# –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
curl -X POST -H "Content-Type: application/x-www-form-urlencoded" \
     -d "q=test&category_general=1" \
     http://localhost:8081/search
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
# –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
time curl -s -X POST \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "q=performance test" \
  http://localhost:8081/search >/dev/null

# –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
for i in {1..10}; do
  curl -s -X POST -d "q=test$i" http://localhost:8081/search >/dev/null &
done
wait
```

## üîß Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. SearXNG –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps searxng

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs searxng

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart searxng
```

#### 2. –û—à–∏–±–∫–∏ Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
docker-compose exec redis redis-cli ping

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose exec searxng env | grep REDIS
```

#### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å rate limiting
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose exec nginx nginx -t

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Nginx
docker-compose logs nginx | grep "limit_req"
```

### –û—Ç–ª–∞–¥–∫–∞
```bash
# –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä SearXNG
docker-compose exec searxng sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose exec searxng cat /etc/searxng/settings.yml

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ uWSGI
docker-compose exec searxng ps aux | grep uwsgi
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [SearXNG Documentation](https://docs.searxng.org/)
- [uWSGI Configuration](https://uwsgi-docs.readthedocs.io/)
- [Nginx Rate Limiting](https://nginx.org/en/docs/http/ngx_http_limit_req_module.html)
- [Docker Security Best Practices](https://docs.docker.com/engine/security/)

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ SearXNG
docker-compose pull searxng
docker-compose up -d searxng

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
./scripts/test-searxng-integration.sh
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
tar -czf searxng-config-backup-$(date +%Y%m%d).tar.gz \
  conf/searxng/ env/searxng.env

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
tar -xzf searxng-config-backup-YYYYMMDD.tar.gz
```
