---
language: ru
translation_status: complete
doc_version: '2025.11'
last_updated: '2025-11-24'
---

# Context Engineering 101

## Что такое контекст-инжиниринг

Контекст-инжиниринг — это управление входными данными модели: какие факты,
правила и историю мы передаём вместе с промптом, чтобы повысить точность и
надёжность ответа (PromptingGuide / LangChain / Datacamp).

## Анатомия контекста в ERNI KI

- **System prompt**: политика и тон ERNI, безопасные ограничения, настройки
  ответа для Open WebUI.
- **Retrieved docs (RAG)**: документы, извлечённые из Docling/Context7 по
  запросу пользователя или инструментам поиска.
- **User history**: недавние сообщения из диалога в Open WebUI, укороченные до
  лимита токенов.
- **Tools**: вызовы через LiteLLM (внешние API, базы данных, сервисы), ответы
  инструментов добавляются в контекст как факты.
- **Схема**: system prompt → (history → retrieved docs) → инструменты →
  финальный ответ. Если токены на исходе, в первую очередь режем историю и
  длинные вложения, а не system prompt.

## Практика: чек-листы

### Обрезка и нормализация контекста (Redis blog / Habr)

- Удаляйте устаревшие версии документов; оставляйте последний релевантный
  фрагмент.
- Рефакторьте большие ответы в сжатые резюме перед повторным использованием.
- Чанкование: 400–800 токенов на кусок, с перекрытием 10–15 %, чтобы не терять
  смысловые связи.
- Для длинных цепочек запросов сохраняйте краткие state-сводки, а не полную
  историю.

### Выбор источников (Datacamp / DigitalOcean)

- Сначала используйте проверенные внутренние базы (Context7, Docling); внешние
  ссылки — только после отметки о доверии.
- Явно указывайте приоритет: "используй только эти выдержки" или "если нет
  фактов — скажи об этом".
- Разделяйте источники по типу: требования бизнеса, архитектура, журналы ошибок
  — чтобы модель не смешивала факты.

### Защита данных (Redis blog / Habr)

- Не отправляйте PII/внутренние ссылки без явного разрешения; заменяйте плейс
  холдерами до очистки.
- Обнуляйте кэшированные фрагменты с чувствительными данными (TTL/ручное
  удаление) и не сохраняйте их в истории диалога.
- Для выгрузки журналов обрезайте поля с токенами доступа и cookie.

## RAG и advanced-темы для инженеров (VDF / Neo4j / Medium / Anthropic)

- **Фильтрация и сортировка**: доэмбеддинг VDF для шумных данных; reranker
  поверх retriever, чтобы убрать оффтоп.
- **Графовый RAG**: Neo4j для связей между сущностями (клиент → система → тикет)
  и объяснимых путей ответа.
- **Конвейеры качества**: валидация источников, маркировка доверия, контроль
  свежести перед подачей модели.
- **Безопасность**: запуск ответов через safety-контуры (Anthropic), явные
  инструкции о запрете генерации фактов.
