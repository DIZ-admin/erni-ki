---
title: 'Управление контекстом'
level: intermediate
duration: '20 min'
prerequisites: ['prompting-fundamentals.md']
language: ru
translation_status: complete
doc_version: '2025.11'
last_updated: '2025-12-04'
---

# Управление контекстом

## Что вы узнаете

- Как работает контекстное окно ИИ
- Как сохранять важную информацию в диалоге
- Когда начинать новый чат
- Техники для длинных разговоров
- Как эффективно использовать память ИИ

## ⏱ Требуемое время

20 минут

## Предварительные требования

- Прочитали [Prompting Fundamentals](prompting-fundamentals.md)
- Имеете опыт работы с Open WebUI

---

## Что такое контекст?

**Контекст** — это вся информация, которую ИИ "помнит" и использует для ответа
на ваш текущий запрос.

### Что включает контекст:

```
Контекст включает:
 Системный промпт (настройки модели)
 Вся история текущего чата
 Ваши предыдущие сообщения
 Ответы ИИ
 Прикреплённые файлы
 Ваш текущий запрос
```

### Простая аналогия

Представьте разговор с коллегой:

**С контекстом:**

```
Вы: Давай обсудим проект X
Коллега: Хорошо, какие аспекты?
Вы: Архитектуру
Коллега: [понимает что речь про проект X]
Вы: Какие риски?
Коллега: [понимает что риски архитектуры проекта X]
```

**Без контекста:**

```
Вы: Какие риски?
Коллега: Риски чего? Какого проекта?
```

---

## Ограничения контекстного окна

### Размеры контекстных окон

| Модель     | Размер окна | ~Эквивалент                  |
| ---------- | ----------- | ---------------------------- |
| GPT-4o     | 128K tokens | ~96,000 слов / ~200 страниц  |
| Claude 3.5 | 200K tokens | ~150,000 слов / ~300 страниц |
| Llama 3.1  | 128K tokens | ~96,000 слов / ~200 страниц  |

**Что такое token?**

- 1 token ≈ 0.75 слова (английский)
- 1 token ≈ 0.5 слова (русский, из-за кириллицы)
- "Hello" = 1 token
- "Привет" = 2-3 tokens

### Что происходит при достижении лимита?

```
Опция 1: Truncation (обрезка)
 Старые сообщения удаляются
 Сохраняются только недавние
 ИИ "забывает" начало разговора

Опция 2: Summarization (суммаризация)
 ИИ создаёт summary старых сообщений
 Хранит summary + недавние сообщения
 Некоторые детали могут потеряться

Опция 3: Ошибка
 Система просит начать новый чат
```

---

## Стратегии управления контекстом

### Стратегия 1: Начинайте с Summary

**Когда:** Длинные обсуждения, complex projects

**Как:** В начале чата дайте comprehensive summary

**Пример:**

```
Контекст нашего проекта:
- Название: E-commerce платформа "ShopX"
- Стек: React, Node.js, PostgreSQL
- Команда: 5 разработчиков
- Сроки: 3 месяца
- Основная задача: Миграция с монолита на микросервисы

Держи это в памяти для всех последующих вопросов.
```

**Эффект:** ИИ будет использовать этот контекст во всех ответах

---

### Стратегия 2: Периодически "напоминайте"

**Когда:** Очень длинные диалоги (20+ сообщений)

**Как:** Периодически повторяйте ключевую информацию

**Пример:**

```
Сообщение 1: "Разрабатываем API для финтех приложения..."
[15 сообщений спустя]
Сообщение 16: "Напомню: мы работаем с финтех приложением
со строгими security требованиями. Теперь вопрос: как..."
```

---

### Стратегия 3: Используйте Reference Markers

**Когда:** Нужно сослаться на предыдущую информацию

**Как:** Явно укажите на что ссылаетесь

**Пример:**

```
Вы: Вот три варианта архитектуры: [A, B, C]
ИИ: [анализирует]
Вы: Теперь возьми вариант B из предыдущего ответа
 и детализируй его database layer
```

**Vs неэффективно:**

```
Вы: Детализируй database layer
[ИИ не знает для какого варианта]
```

---

### Стратегия 4: Разбивайте на sub-chats

**Когда:** Множество несвязанных тем

**Как:** Отдельный чат для каждой темы

**Пример:**

```
Chat 1: "Проект X - Архитектура"
Chat 2: "Проект X - Тестирование"
Chat 3: "Проект X - Deployment"
```

**Vs плохо:**

```
Chat 1: "Проект X" [всё вперемешку]
- Архитектура
- Тестирование
- Deployment
- Bug fixes
- ...
[контекст становится запутанным]
```

---

### Стратегия 5: Context Pruning (Обрезка контекста)

**Когда:** Чат становится слишком длинным

**Как:** Создайте summary и начните новый чат

**Пример:**

```
В старом чате:
"Суммируй наш разговор последние 20 сообщений.
Включи ключевые решения и выводы."

В новом чате:
"Контекст из предыдущего обсуждения:
[вставить summary]

Теперь продолжим с вопроса: ..."
```

---

## Техники для длинных диалогов

### Техника 1: "Anchor Points"

Создавайте якорные точки в диалоге:

```
Вы: "Назовём это Решение A. Запомни для дальнейших ссылок."
[10 сообщений спустя]
Вы: "Теперь сравни Решение A с новым подходом"
```

### Техника 2: Numbered Lists

Нумеруйте важные элементы:

```
Вы: "У нас есть три требования:
1. Security: [детали]
2. Performance: [детали]
3. Scalability: [детали]"

[Позже]
Вы: "Как Решение B справляется с требованием #2?"
```

### Техника 3: Explicit State Management

Явно управляйте "состоянием" диалога:

```
Вы: "Фаза 1: Соберём requirements [обсуждение]"
Вы: "Фаза 1 завершена. Переходим к Фазе 2: Design"
Вы: "Вернёмся к Фазе 1, requirement #3..."
```

### Техника 4: Context Windows

Для очень длинных documents:

```
Вы: "Вот первая часть документа (страницы 1-10): [текст]
Проанализируй и жди следующей части."

Вы: "Вторая часть (страницы 11-20): [текст]
Теперь дай общий анализ обеих частей."
```

---

## Частые проблемы и решения

### Проблема 1: ИИ "забыл" начало разговора

**Симптомы:**

```
Вы: Вернёмся к той идее с микросервисами
ИИ: Извините, я не вижу упоминания микросервисов
 в нашем разговоре
```

**Причина:** Контекст переполнен, старые сообщения обрезаны

**Решение 1:** Начните новый чат с summary

```
Summary предыдущего обсуждения:
[ключевые пункты]

Теперь продолжим обсуждение микросервисной архитектуры...
```

**Решение 2:** Повторите ключевую информацию

```
Напомню: ранее мы обсуждали миграцию на микросервисы
с использованием Docker и Kubernetes. Теперь вопрос: ...
```

---

### Проблема 2: Путаница из-за похожих сущностей

**Симптомы:**

```
Вы: Как Database A справляется с нагрузкой?
ИИ: [даёт ответ про Database B]
```

**Причина:** В контексте много похожих entity, ИИ путается

**Решение:** Используйте чёткие unique идентификаторы

```
База данных #1 (PostgreSQL для user data)
База данных #2 (MongoDB для logs)
База данных #3 (Redis для caching)

Вопрос: Как База #1 справляется с нагрузкой?
```

---

### Проблема 3: Конфликтующая информация

**Симптомы:**

```
Сообщение 5: "Мы используем React"
Сообщение 20: "Мы используем Vue"
ИИ: [не знает что актуально]
```

**Решение:** Явно отмечайте изменения

```
ОБНОВЛЕНИЕ: Мы решили сменить фреймворк с React на Vue.
Все предыдущие упоминания React больше не актуальны.
Используй Vue для дальнейших рекомендаций.
```

---

### Проблема 4: Избыточный контекст

**Симптомы:**

```
Чат содержит 50+ сообщений с debug output, logs, примерами
ИИ: Ответы становятся медленными и менее точными
```

**Решение:** Очистите неактуальное

```
Создайте новый чат:
"Резюме предыдущего debugging session:
- Проблема была в [X]
- Решение: [Y]
- Текущий статус: [Z]

Продолжаем с чистого листа."
```

---

## Когда начинать новый чат?

### Сигналы что пора начать новый чат:

1. **Длина > 30-40 сообщений**

- Контекст становится громоздким
- ИИ может путаться

2. **Смена темы**

- Переходите от архитектуры к тестированию
- Начали обсуждать новый проект

3. **ИИ "забывает" информацию**

- Приходится часто напоминать
- Answers становятся generic

4. **Накопление obsolete информации**

- Много устаревших данных в истории
- Изменились requirements

5. **Медленные ответы**

- ИИ долго обрабатывает запросы
- Признак большого контекста

### Как правильно переносить контекст:

```
Шаг 1: В старом чате
"Создай structured summary нашего обсуждения:
1. Ключевые решения
2. Открытые вопросы
3. Next steps
4. Important constraints"

Шаг 2: Скопируйте summary

Шаг 3: В новом чате
"Контекст из предыдущего обсуждения:
[вставить summary]

Мы остановились на: [последний пункт]
Продолжаем с: [следующий шаг]"
```

---

## Практические паттерны

### Паттерн 1: Project Context Template

```markdown
## Project Context (сохранить в начале чата)

**Project:** [название] **Stack:** [технологии] **Team:** [размер команды]
**Timeline:** [сроки] **Status:** [текущий статус]

**Key Constraints:**

- [constraint 1]
- [constraint 2]

**Current Phase:** [фаза проекта]

---

Держи этот контекст для всех вопросов.
```

### Паттерн 2: Decision Log

```markdown
## Decisions Made (обновлять по ходу)

Decision #1: [дата]

- Question: [вопрос]
- Options: [варианты]
- Chosen: [выбор]
- Rationale: [причины]

Decision #2: [дата] ...

Используй эти решения как baseline для новых вопросов.
```

### Паттерн 3: Running Summary

```markdown
## Session Summary (обновлять каждые 10 сообщений)

**Discussed:**

- [тема 1]: [ключевые пункты]
- [тема 2]: [ключевые пункты]

**Decisions:**

- [решение 1]
- [решение 2]

**Open Questions:**

- [вопрос 1]
- [вопрос 2]

**Next Steps:**

- [шаг 1]
- [шаг 2]
```

---

## Advanced Tips

### Tip 1: Contextual Anchors

Создавайте "якоря" в контексте:

```
Вы: "Определим базовые термины для этого обсуждения:
- Service A = user authentication microservice
- Database X = PostgreSQL cluster for user data
- Cache Y = Redis instance for sessions

Используй эти обозначения последовательно."
```

### Tip 2: Gradual Context Building

Наращивайте контекст постепенно:

```
Сообщение 1: High-level overview
Сообщение 2: Добавить technical constraints
Сообщение 3: Добавить team context
Сообщение 4: Теперь задать complex вопрос с учётом всего
```

Vs неэффективно: dump всего контекста сразу

### Tip 3: Context Checkpoints

Периодически проверяйте понимание:

```
Каждые 15 сообщений:
"Подтверди что ты помнишь:
1. Мы разрабатываем [X]
2. Ключевые constraints: [Y]
3. Текущая фаза: [Z]"
```

### Tip 4: Version Context

Для evolving discussions:

```
"Context Version 1.0 (начало проекта):
[исходные требования]

Context Version 2.0 (после review):
[обновлённые требования]
Changes: [что изменилось]

Используй Version 2.0 для всех новых вопросов."
```

---

## Чек-лист Context Management

### Перед началом чата:

- [ ] Определил ключевую информацию для контекста
- [ ] Подготовил summary если это продолжение
- [ ] Выбрал подходящую модель (bigger context window если нужно)

### Во время чата:

- [ ] Использую clear identifiers для entity
- [ ] Периодически напоминаю ключевые constraints
- [ ] Отмечаю изменения в requirements
- [ ] Слежу за длиной разговора

### Признаки что пора в новый чат:

- [ ] > 30-40 сообщений
- [ ] ИИ начинает "забывать"
- [ ] Накопилось много obsolete информации
- [ ] Меняется тема или проект
- [ ] Ответы стали медленными

---

## Проверка понимания

**1. Что такое контекстное окно?**

<details>
<summary>Ответ</summary>
Лимит информации которую ИИ может "помнить" и обрабатывать за раз. Измеряется в tokens.
</details>

**2. Когда стоит начать новый чат?**

<details>
<summary>Ответ</summary>
- При >30-40 сообщениях
- При смене темы
- Когда ИИ забывает информацию
- При накоплении obsolete данных
</details>

**3. Как перенести контекст в новый чат?**

<details>
<summary>Ответ</summary>
Создать summary в старом чате, скопировать ключевые пункты в начало нового чата.
</details>

---

## Дальнейшее изучение

- [RAG Basics](rag-basics.md) — Работа с большими документами
- [Effective Prompts](effective-prompts.md) — Продвинутые техники
- [Advanced Techniques](../advanced/index.md) — Expert patterns

---

**Следующий шаг:** [RAG Basics →](rag-basics.md)
