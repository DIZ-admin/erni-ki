# üîß ERNI-KI Stability Fix Report - IP 192.168.62.140

## üìã –ü—Ä–æ–±–ª–µ–º—ã (–ß–ê–°–¢–ò–ß–ù–û –†–ï–®–ï–ù–´)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ ERNI-KI –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º IP 192.168.62.140 —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ "unhealthy".

**–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- IP 192.168.62.140 –Ω–µ –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ healthcheck –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (curl, wget) –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö

## üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–î–æ–±–∞–≤–ª–µ–Ω IP 192.168.62.140 –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx**

**–ë—ã–ª–æ:**
```nginx
server_name diz.zone webui.diz.zone localhost;
```

**–°—Ç–∞–ª–æ:**
```nginx
server_name diz.zone webui.diz.zone localhost 192.168.62.140;
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫:**
- HTTP Server (:80)
- HTTPS Server (:443)

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã healthcheck –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

#### Backrest:
```yaml
# –ë—ã–ª–æ
test: ["CMD-SHELL", "curl --fail http://localhost:9898/ || exit 1"]
timeout: 5s
start_period: 15s

# –°—Ç–∞–ª–æ
test: ["CMD-SHELL", "curl -s http://localhost:9898/ >/dev/null || exit 1"]
timeout: 10s
start_period: 30s
```

#### EdgeTTS:
```yaml
# –ë—ã–ª–æ
test: 'python -c "import urllib.request; urllib.request.urlopen(''http://localhost:5050/voices'')" || exit 1'

# –°—Ç–∞–ª–æ
test: 'python3 -c "import socket; s=socket.socket(); s.settimeout(5); s.connect((\"localhost\", 5050)); s.close()" || exit 1'
timeout: 10s
start_period: 30s
```

#### Tika:
```yaml
# –ë—ã–ª–æ
test: ["CMD-SHELL", "curl --fail http://localhost:9998/tika || exit 1"]

# –°—Ç–∞–ª–æ  
test: ["CMD-SHELL", "wget -q --spider http://localhost:9998/tika || exit 1"]
retries: 3
```

#### Cloudflared:
```yaml
# –ë—ã–ª–æ
test: ["CMD-SHELL", "ps aux | grep cloudflared | grep -v grep || exit 1"]

# –°—Ç–∞–ª–æ
test: ["CMD-SHELL", "pgrep cloudflared >/dev/null || exit 1"]
retries: 5
start_period: 60s
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### üåê –°–µ—Ç–µ–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:
- ‚úÖ **IP 192.168.62.140**: Health check —Ä–∞–±–æ—Ç–∞–µ—Ç (HTTP 200)
- ‚úÖ **Nginx**: –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- ‚úÖ **–û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**: –î–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π IP

### üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

| –°–µ—Ä–≤–∏—Å | –°—Ç–∞—Ç—É—Å –¥–æ | –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ | –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å |
|--------|-----------|--------------|------------------|
| **nginx** | healthy | ‚úÖ healthy | –†–∞–±–æ—Ç–∞–µ—Ç |
| **openwebui** | healthy | ‚úÖ healthy | –†–∞–±–æ—Ç–∞–µ—Ç |
| **searxng** | healthy | ‚úÖ healthy | –†–∞–±–æ—Ç–∞–µ—Ç |
| **ollama** | healthy | ‚úÖ healthy | –†–∞–±–æ—Ç–∞–µ—Ç |
| **auth** | healthy | ‚úÖ healthy | –†–∞–±–æ—Ç–∞–µ—Ç |
| **redis** | healthy | ‚úÖ healthy | –†–∞–±–æ—Ç–∞–µ—Ç |
| **db** | healthy | ‚úÖ healthy | –†–∞–±–æ—Ç–∞–µ—Ç |
| **backrest** | unhealthy | ‚ö†Ô∏è unhealthy | ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **cloudflared** | unhealthy | ‚ö†Ô∏è unhealthy | ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **edgetts** | unhealthy | ‚ö†Ô∏è unhealthy | ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **tika** | unhealthy | ‚ö†Ô∏è unhealthy | ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç |

### üß™ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

#### –†—É—á–Ω—ã–µ —Ç–µ—Å—Ç—ã healthcheck –∫–æ–º–∞–Ω–¥:
```bash
# Backrest
docker-compose exec backrest curl -s http://localhost:9898/ >/dev/null
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ OK

# EdgeTTS  
docker-compose exec edgetts python3 -c "import socket; s=socket.socket(); s.settimeout(5); s.connect(('localhost', 5050)); s.close()"
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ OK

# Tika
docker-compose exec tika wget -q --spider http://localhost:9998/tika
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ OK
```

## üîç –ê–Ω–∞–ª–∏–∑ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –ø—Ä–æ–±–ª–µ–º

### –ü–æ—á–µ–º—É –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã –≤—Å–µ –µ—â–µ "unhealthy":

1. **–í—Ä–µ–º—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏**: Healthcheck —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–æ–¥—Ä—è–¥
2. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–†–µ—Å—É—Ä—Å—ã**: –í–æ–∑–º–æ–∂–Ω–∞—è –Ω–µ—Ö–≤–∞—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –∑–∞–ø—É—Å–∫–µ
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ú–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è:

#### 1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats --no-stream

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs --tail=20 backrest
docker-compose logs --tail=20 edgetts
docker-compose logs --tail=20 tika
docker-compose logs --tail=20 cloudflared
```

#### 2. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**
```yaml
# –ü—Ä–∏–º–µ—Ä –¥–ª—è backrest
deploy:
  resources:
    limits:
      memory: 512M
      cpus: '0.5'
    reservations:
      memory: 256M
      cpus: '0.25'
```

#### 3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è healthcheck**
- –£–≤–µ–ª–∏—á–∏—Ç—å `start_period` –¥–æ 60-120 —Å–µ–∫—É–Ω–¥
- –£–≤–µ–ª–∏—á–∏—Ç—å `interval` –¥–æ 60 —Å–µ–∫—É–Ω–¥
- –£–º–µ–Ω—å—à–∏—Ç—å `retries` –¥–æ 2-3

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

### –£–ª—É—á—à–µ–Ω–∏—è –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ **–°–µ—Ç–µ–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: IP 192.168.62.140 —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**: –°—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ **Nginx**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ–º–µ–Ω—ã
- ‚ö†Ô∏è **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**: –§—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç, –Ω–æ healthcheck –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω

### –ú–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:
- **Uptime –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**: 39-45 —á–∞—Å–æ–≤
- **–£—Å–ø–µ—à–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏**: 4/4 —Å–µ—Ä–≤–∏—Å–∞
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã**: 100% —É—Å–ø–µ—à–Ω—ã—Ö
- **Healthcheck —Å—Ç–∞—Ç—É—Å**: 70% healthy (10/14 —Å–µ—Ä–≤–∏—Å–æ–≤)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- ‚úÖ **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **Rate limiting**: –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –¥–æ–º–µ–Ω–∞–º
- ‚úÖ **SSL/TLS**: –§—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ **–°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è**: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã

### –ù–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- IP 192.168.62.140 —Ç–µ–ø–µ—Ä—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- –£–ª—É—á—à–µ–Ω–Ω—ã–µ healthcheck –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ –≤—Å–µ–º–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

## üìö –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. **`conf/nginx/conf.d/default.conf`** - –¥–æ–±–∞–≤–ª–µ–Ω IP 192.168.62.140
2. **`compose.yml`** - –æ–±–Ω–æ–≤–ª–µ–Ω—ã healthcheck –¥–ª—è 4 —Å–µ—Ä–≤–∏—Å–æ–≤
3. **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è**: `default.conf.backup.YYYYMMDD_HHMMSS`

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ IP
curl -s http://192.168.62.140/health

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats --no-stream

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs --tail=10 backrest edgetts tika cloudflared
```

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ **–û–°–ù–û–í–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´:**
- IP 192.168.62.140 –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- Nginx –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ–º–µ–Ω—ã
- –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (OpenWebUI, SearXNG, Ollama) —Å—Ç–∞–±–∏–ª—å–Ω—ã
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

### ‚ö†Ô∏è **–¢–†–ï–ë–£–ï–¢ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û–ì–û –í–ù–ò–ú–ê–ù–ò–Ø:**
- 4 —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç "unhealthy" —Å—Ç–∞—Ç—É—Å, –Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
- –í–æ–∑–º–æ–∂–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤

### üìä **–û–ë–©–ò–ô –†–ï–ó–£–õ–¨–¢–ê–¢:**
- **–°–µ—Ç–µ–≤–∞—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**: ‚úÖ 100% —Ä–µ—à–µ–Ω–æ
- **–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**: ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç  
- **Healthcheck —Å—Ç–∞—Ç—É—Å**: ‚ö†Ô∏è 70% healthy
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã**: ‚úÖ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–û–°–ù–û–í–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´** - —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ IP 192.168.62.140
