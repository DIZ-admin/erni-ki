# ‚öôÔ∏è –ü—Ä–æ—Ü–µ—Å—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π ERNI-KI

**–í–µ—Ä—Å–∏—è:** 1.0 **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-09-25 **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
2025-09-25 **–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** Tech Lead

---

## üìã –û–ë–©–ò–ï –ü–†–ò–ù–¶–ò–ü–´

### ‚úÖ **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –í–°–ï–• –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

1. **Backup –ü–ï–†–ï–î –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º** - –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Ä–µ–¥–µ
3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º
4. **Rollback –ø–ª–∞–Ω** - –≥–æ—Ç–æ–≤–∏—Ç—å –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### ‚ö†Ô∏è **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

- **üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï** - –≤–ª–∏—è—é—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã (—Ç—Ä–µ–±—É—é—Ç maintenance
  window)
- **üü° –í–ê–ñ–ù–´–ï** - –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Ç—Ä–µ–±—É—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
- **üü¢ –ú–ò–ù–û–†–ù–´–ï** - –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è)

---

## üîÑ –°–¢–ê–ù–î–ê–†–¢–ù–´–ô –ü–†–û–¶–ï–°–° –ò–ó–ú–ï–ù–ï–ù–ò–ô

### **–≠–¢–ê–ü 1: –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï**

#### **1.1 –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

```bash
# –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "–¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏—è: [–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï/–í–ê–ñ–ù–û–ï/–ú–ò–ù–û–†–ù–û–ï]"
echo "–ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã: [—Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤]"
echo "–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è: [–º–∏–Ω—É—Ç—ã]"
echo "Rollback –≤—Ä–µ–º—è: [–º–∏–Ω—É—Ç—ã]"
```

#### **1.2 –°–æ–∑–¥–∞–Ω–∏–µ Change Request**

```markdown
## Change Request #CR-YYYYMMDD-XXX

**–î–∞—Ç–∞:** YYYY-MM-DD **–ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä:** [–ò–º—è] **–¢–∏–ø:** [–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï/–í–ê–ñ–ù–û–ï/–ú–ò–ù–û–†–ù–û–ï]

### –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

[–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —á—Ç–æ –∏ –∑–∞—á–µ–º –∏–∑–º–µ–Ω—è–µ—Ç—Å—è]

### –ó–∞—Ç—Ä–∞–≥–∏–≤–∞–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- [ ] Docker Compose (compose.yml)
- [ ] Environment —Ñ–∞–π–ª—ã (env/\*)
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ (conf/\*)
- [ ] Nginx –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- [ ] Prometheus/Grafana
- [ ] –î—Ä—É–≥–æ–µ: [—É–∫–∞–∑–∞—Ç—å]

### –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è:

[–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ –∏ —Å–ø–æ—Å–æ–±–æ–≤ –∏—Ö —Å–Ω–∏–∂–µ–Ω–∏—è]

### –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

[–ö–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ]

### Rollback –ø–ª–∞–Ω:

[–ö–∞–∫ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º]
```

### **–≠–¢–ê–ü 2: –ü–û–î–ì–û–¢–û–í–ö–ê**

#### **2.1 –°–æ–∑–¥–∞–Ω–∏–µ backup**

```bash
# –°–æ–∑–¥–∞—Ç—å timestamped backup
BACKUP_DIR=".config-backup/change-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"

# Backup –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
sudo cp -r env/ "$BACKUP_DIR/"
sudo cp -r conf/ "$BACKUP_DIR/"
cp compose.yml "$BACKUP_DIR/"

# Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)
docker exec erni-ki-db-1 pg_dump -U postgres openwebui > "$BACKUP_DIR/database-backup.sql"

# –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
docker compose ps > "$BACKUP_DIR/services-status-before.txt"
docker compose config > "$BACKUP_DIR/compose-config-before.yml"

echo "Backup —Å–æ–∑–¥–∞–Ω –≤: $BACKUP_DIR"
```

#### **2.2 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ rollback —Å–∫—Ä–∏–ø—Ç–∞**

```bash
# –°–æ–∑–¥–∞—Ç—å rollback.sh
cat > rollback.sh << 'EOF'
#!/bin/bash
set -e

BACKUP_DIR="$1"
if [ -z "$BACKUP_DIR" ]; then
    echo "Usage: $0 <backup_directory>"
    exit 1
fi

echo "üîÑ –ù–∞—á–∏–Ω–∞–µ–º rollback –∏–∑ $BACKUP_DIR"

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker compose down

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo cp -r "$BACKUP_DIR/env/" ./
sudo cp -r "$BACKUP_DIR/conf/" ./
cp "$BACKUP_DIR/compose.yml" ./

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker compose up -d

echo "‚úÖ Rollback –∑–∞–≤–µ—Ä—à–µ–Ω"
EOF

chmod +x rollback.sh
```

### **–≠–¢–ê–ü 3: –í–´–ü–û–õ–ù–ï–ù–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô**

#### **3.1 –î–ª—è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –∏–∑–º–µ–Ω–µ–Ω–∏–π**

```bash
# 1. –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
echo "üö® MAINTENANCE WINDOW: $(date) - –ü–ª–∞–Ω–æ–≤–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã"

# 2. –°–æ–∑–¥–∞—Ç—å maintenance —Å—Ç—Ä–∞–Ω–∏—Ü—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
docker run -d --name maintenance -p 80:80 nginx:alpine
docker exec maintenance sh -c 'echo "<h1>–°–∏—Å—Ç–µ–º–∞ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏</h1><p>–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: 30 –º–∏–Ω—É—Ç</p>" > /usr/share/nginx/html/index.html'

# 3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose stop openwebui nginx

# 4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
[–≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è]

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker compose up -d

# 6. –£–±—Ä–∞—Ç—å maintenance —Å—Ç—Ä–∞–Ω–∏—Ü—É
docker stop maintenance && docker rm maintenance
```

#### **3.2 –î–ª—è –í–ê–ñ–ù–´–• –∏–∑–º–µ–Ω–µ–Ω–∏–π**

```bash
# 1. –£–≤–µ–¥–æ–º–∏—Ç—å –æ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–±–æ—è—Ö
echo "‚ÑπÔ∏è –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–ª–∞–Ω–æ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–æ—Å—Ç–æ–µ–º
[–≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è]

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose restart [—Å–ø–∏—Å–æ–∫_—Å–µ—Ä–≤–∏—Å–æ–≤]
```

#### **3.3 –î–ª—è –ú–ò–ù–û–†–ù–´–• –∏–∑–º–µ–Ω–µ–Ω–∏–π**

```bash
# 1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
[–≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è]

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
docker compose up -d --no-recreate
```

### **–≠–¢–ê–ü 4: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï**

#### **4.1 –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö endpoints
curl -f http://localhost/health && echo "‚úÖ OpenWebUI —Ä–∞–±–æ—Ç–∞–µ—Ç" || echo "‚ùå OpenWebUI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
curl -f http://localhost:11434/api/tags && echo "‚úÖ Ollama —Ä–∞–±–æ—Ç–∞–µ—Ç" || echo "‚ùå Ollama –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
curl -s -I https://ki.erni-gruppe.ch/health | head -1 && echo "‚úÖ –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç" || echo "‚ùå –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏
docker compose logs --since 5m | grep -i error | tail -10
```

#### **4.2 –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)**

```bash
# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
# 1. –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
curl -X POST http://localhost/api/v1/auths/signin \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test"}'  # pragma: allowlist secret

# 2. –¢–µ—Å—Ç AI —Ñ—É–Ω–∫—Ü–∏–π
curl -X POST http://localhost:11434/api/generate \
  -H "Content-Type: application/json" \
  -d '{"model":"llama2","prompt":"Hello","stream":false}'

# 3. –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ (SearXNG)
curl -f "http://localhost:8080/search?q=test&format=json"

# 4. –¢–µ—Å—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
curl -f http://localhost:9090/api/v1/query?query=up
```

### **–≠–¢–ê–ü 5: –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –í–ê–õ–ò–î–ê–¶–ò–Ø**

#### **5.1 –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–ø–µ—Ä–≤—ã–µ 30 –º–∏–Ω—É—Ç)**

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
for i in {1..6}; do
    echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ #$i ($(date)) ==="
    docker compose ps | grep -v "Up"  # –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
    docker compose logs --since 5m | grep -i error | wc -l  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
    sleep 300
done
```

#### **5.2 –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–ø–µ—Ä–≤—ã–µ 24 —á–∞—Å–∞)**

```bash
# –°–æ–∑–¥–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∫—Ä–∏–ø—Ç
cat > monitor-changes.sh << 'EOF'
#!/bin/bash
LOG_FILE="change-monitoring-$(date +%Y%m%d).log"

while true; do
    echo "$(date): Checking system health" >> $LOG_FILE

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    curl -f http://localhost/health >> $LOG_FILE 2>&1 || echo "$(date): OpenWebUI DOWN" >> $LOG_FILE

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫
    ERROR_COUNT=$(docker compose logs --since 1h | grep -i error | wc -l)
    echo "$(date): Errors in last hour: $ERROR_COUNT" >> $LOG_FILE

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
    echo "$(date): Memory usage: $(free -h | grep Mem | awk '{print $3}')" >> $LOG_FILE

    sleep 3600  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–π —á–∞—Å
done
EOF

chmod +x monitor-changes.sh
nohup ./monitor-changes.sh &
```

---

## üìù –¢–ò–ü–û–í–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### **üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**

```bash
# 1. Backup
cp env/service.env env/service.env.backup-$(date +%Y%m%d-%H%M%S)

# 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ
sed -i 's/OLD_VALUE/NEW_VALUE/g' env/service.env

# 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
docker compose up -d service --no-recreate

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
docker compose logs service --tail=20
```

### **üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Docker –æ–±—Ä–∞–∑–∞**

```bash
# 1. Backup —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker compose config > compose-backup-$(date +%Y%m%d-%H%M%S).yml

# 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –≤ compose.yml
sed -i 's/service:old-version/service:new-version/g' compose.yml

# 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
docker compose pull service
docker compose up -d service

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞
docker compose ps service
docker compose logs service --tail=20
```

### **üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx**

```bash
# 1. Backup
cp conf/nginx/conf.d/default.conf conf/nginx/conf.d/default.conf.backup-$(date +%Y%m%d-%H%M%S)

# 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
[—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª]

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
docker exec erni-ki-nginx-1 nginx -t

# 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
docker exec erni-ki-nginx-1 nginx -s reload

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞
curl -I http://localhost
```

### **üîß –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Prometheus**

```bash
# 1. Backup
cp conf/prometheus/prometheus.yml conf/prometheus/prometheus.yml.backup-$(date +%Y%m%d-%H%M%S)

# 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
[—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª]

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
docker exec erni-ki-prometheus promtool check config /etc/prometheus/prometheus.yml

# 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ
docker exec erni-ki-prometheus kill -HUP 1

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞
curl -f http://localhost:9090/api/v1/targets
```

---

## üö® –≠–ö–°–¢–†–ï–ù–ù–´–ï –ü–†–û–¶–ï–î–£–†–´

### **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π rollback**

```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
./rollback.sh .config-backup/change-YYYYMMDD-HHMMSS

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
docker compose ps
curl -f http://localhost/health
```

### **–ß–∞—Å—Ç–∏—á–Ω—ã–π rollback**

```bash
# –û—Ç–∫–∞—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose stop service
cp backup/env/service.env env/
docker compose up -d service
```

---

## üìä –û–¢–ß–ï–¢–ù–û–°–¢–¨

### **Post-Change Report Template**

```markdown
## Post-Change Report #CR-YYYYMMDD-XXX

**–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** YYYY-MM-DD HH:MM **–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** [–ò–º—è] **–°—Ç–∞—Ç—É—Å:**
[–£–°–ü–ï–®–ù–û/–û–¢–ö–ê–ß–ï–ù–û/–ß–ê–°–¢–ò–ß–ù–û]

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

[–°–ø–∏—Å–æ–∫ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π]

### –í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è:

**–ü–ª–∞–Ω–æ–≤–æ–µ:** X –º–∏–Ω—É—Ç **–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ:** Y –º–∏–Ω—É—Ç

### –ü—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ:

[–û–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–Ω–∏–∫—à–∏—Ö –ø—Ä–æ–±–ª–µ–º –∏ —Å–ø–æ—Å–æ–±–æ–≤ —Ä–µ—à–µ–Ω–∏—è]

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

- [ ] –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å

### –£—Ä–æ–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

[–ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑]
```

---

## üìö –°–í–Ø–ó–ê–ù–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´

- [Service Restart Procedures](service-restart-procedures.md)
- [Troubleshooting Guide](troubleshooting-guide.md)
- [Backup Restore Procedures](backup-restore-procedures.md)
- [System Architecture](../architecture.md)

---

_–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π ERNI-KI 2025-09-25_
