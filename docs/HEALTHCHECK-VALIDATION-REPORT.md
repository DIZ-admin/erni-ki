# –û—Ç—á–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Healthcheck –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö healthcheck –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –≤ Docker
–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ erni-ki.

## üîç –ê–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–∏–µ healthcheck –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

```yaml
# –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
test: curl --fail http://localhost:8080/health || exit 1

# –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
test: ["CMD-SHELL", "curl --fail http://localhost:8080/health || exit 1"]
```

#### 2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã healthcheck –±—ã–ª–∏ –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

```yaml
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:
healthcheck:
  test: ['CMD-SHELL', 'command']
  interval: 30s
  timeout: 3s
  retries: 5
  start_period: 10s
```

#### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ healthcheck**

–î–æ–±–∞–≤–ª–µ–Ω—ã healthcheck –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤:

- `cloudflared` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç—É–Ω–Ω–µ–ª—è
- `mcposerver` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- `watchtower` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

## üìã –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### 1. **auth** ‚úÖ

```yaml
healthcheck:
  test: ['CMD', '/app/main', '--health-check']
  interval: 30s
  timeout: 3s
  retries: 3
  start_period: 5s
```

- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ `--health-check`
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** HTTP GET http://localhost:9090/health
- **–°—Ç–∞—Ç—É—Å:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ Go –∫–æ–¥–µ

### 2. **db (PostgreSQL)** ‚úÖ

```yaml
healthcheck:
  test: ['CMD-SHELL', 'pg_isready -d $${POSTGRES_DB} -U $${POSTGRES_USER}']
  interval: 30s
  timeout: 5s
  retries: 5
  start_period: 20s
```

- **–ö–æ–º–∞–Ω–¥–∞:** `pg_isready` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ PostgreSQL
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º

### 3. **redis** ‚úÖ

```yaml
healthcheck:
  test: ['CMD-SHELL', 'redis-cli ping | grep PONG']
  interval: 30s
  timeout: 3s
  retries: 5
  start_period: 20s
```

- **–ö–æ–º–∞–Ω–¥–∞:** `redis-cli ping`
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –û—Ç–≤–µ—Ç PONG –æ—Ç Redis —Å–µ—Ä–≤–µ—Ä–∞

### 4. **ollama** ‚úÖ

```yaml
healthcheck:
  test:
    ['CMD-SHELL', 'curl --fail http://localhost:11434/api/version || exit 1']
  interval: 30s
  timeout: 3s
  retries: 5
  start_period: 10s
```

- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/api/version`
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** API –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Ollama —Å–µ—Ä–≤–µ—Ä–∞

### 5. **openwebui** ‚úÖ

```yaml
healthcheck:
  test: ['CMD-SHELL', 'curl --fail http://localhost:8080/health || exit 1']
  interval: 30s
  timeout: 3s
  retries: 5
  start_period: 10s
```

- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/health`
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### 6. **nginx** ‚úÖ

```yaml
healthcheck:
  test: ['CMD-SHELL', 'curl --fail http://localhost/ || exit 1']
  interval: 30s
  timeout: 3s
  retries: 5
  start_period: 5s
```

- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/` (–∫–æ—Ä–Ω–µ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** HTTP –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–æ–∫—Å–∏

### 7. **searxng** ‚úÖ

```yaml
healthcheck:
  test: ['CMD-SHELL', 'curl --fail http://localhost:8080/ || exit 1']
  interval: 30s
  timeout: 3s
  retries: 5
  start_period: 10s
```

- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/` (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∏—Å–∫–∞)
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞

### 8. **docling** ‚úÖ

```yaml
healthcheck:
  test: ['CMD-SHELL', 'curl --fail http://localhost:5001/health || exit 1']
  interval: 30s
  timeout: 5s
  retries: 5
  start_period: 10s
```

- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/health`
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### 9. **tika** ‚úÖ

```yaml
healthcheck:
  test: ['CMD-SHELL', 'curl --fail http://localhost:9998/tika || exit 1']
  interval: 30s
  timeout: 5s
  retries: 5
  start_period: 5s
```

- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/tika`
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Apache Tika API

### 10. **edgetts** ‚úÖ

```yaml
healthcheck:
  test: ['CMD-SHELL', 'curl --fail http://localhost:5050/voices || exit 1']
  interval: 30s
  timeout: 5s
  retries: 5
  start_period: 5s
```

- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/voices`
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å TTS API

### 11. **cloudflared** ‚úÖ (–¥–æ–±–∞–≤–ª–µ–Ω)

```yaml
healthcheck:
  test: ['CMD-SHELL', 'cloudflared tunnel info || exit 1']
  interval: 60s
  timeout: 10s
  retries: 3
  start_period: 30s
```

- **–ö–æ–º–∞–Ω–¥–∞:** `cloudflared tunnel info`
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –°—Ç–∞—Ç—É—Å Cloudflare —Ç—É–Ω–Ω–µ–ª—è

### 12. **mcposerver** ‚úÖ (–¥–æ–±–∞–≤–ª–µ–Ω)

```yaml
healthcheck:
  test: ['CMD-SHELL', 'ps aux | grep mcpo | grep -v grep || exit 1']
  interval: 30s
  timeout: 5s
  retries: 3
  start_period: 10s
```

- **–ö–æ–º–∞–Ω–¥–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –†–∞–±–æ—Ç—É MCP —Å–µ—Ä–≤–µ—Ä–∞

### 13. **watchtower** ‚úÖ (–¥–æ–±–∞–≤–ª–µ–Ω)

```yaml
healthcheck:
  test: ['CMD-SHELL', 'ps aux | grep watchtower | grep -v grep || exit 1']
  interval: 60s
  timeout: 5s
  retries: 3
  start_period: 10s
```

- **–ö–æ–º–∞–Ω–¥–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:** –†–∞–±–æ—Ç—É Watchtower

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º

### –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

- **interval:** 30s (—Å—Ç–∞–Ω–¥–∞—Ä—Ç), 60s (–¥–ª—è –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)
- **timeout:** 3-5s (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏)
- **retries:** 3-5 (–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å—é –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é)
- **start_period:** 5-30s (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞)

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏:

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** start_period: 20s (–º–µ–¥–ª–µ–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç)
- **Cloudflared:** interval: 60s (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫)
- **GPU —Å–µ—Ä–≤–∏—Å—ã:** start_period: 10s+ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GPU)

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞:

```bash
docker-compose -f compose.yml.example config --quiet
# ‚úÖ –£—Å–ø–µ—à–Ω–æ - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞
```

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:

- [x] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å CMD/CMD-SHELL
- [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É—Ç–∏ –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª–∞–º
- [x] –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –∏ —Ç–∞–π–º–∞—É—Ç—ã
- [x] –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ healthcheck —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- [x] –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Docker Compose —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

**–í—Å–µ healthcheck –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Docker Swarm –∏ Kubernetes

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ healthcheck
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ healthcheck
docker inspect <container_name> | grep Health -A 10
```
