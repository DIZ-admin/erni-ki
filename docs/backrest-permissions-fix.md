# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è Snyk —Å–∫–∞–Ω–µ—Ä–∞

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã

Snyk —Å–∫–∞–Ω–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–µ –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º –≤
`data/` –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ "EACCES: permission denied". –ü—Ä–æ–±–ª–µ–º—ã –≤–æ–∑–Ω–∏–∫–∞–ª–∏ —Å:

- `/data/backrest/repos/erni-ki-local`
- `/data/grafana/alerting/1`
- –î—Ä—É–≥–∏–º–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–º–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ —Å –ø—Ä–∞–≤–∞–º–∏ root

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

**Backrest:**

```bash
drwxr--r--  3 root root 4096 Jul 14 09:00 repos
drwxr--r--  7 root root 4096 Jul 14 09:00 erni-ki-local
```

**Grafana:**

```bash
drwxr-xr--  3 472 root 4096 Jul 17 13:44 alerting
drwxr--r--  2 472 root 4096 Jul 17 13:44 csv
drwxr--r--  2 472 root 4096 Jul 17 13:44 png
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∞–≤–∞ `744` –∏ `754` (drwxr--r--, drwxr-xr--) –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç
–ø—Ä–∞–≤–æ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (execute) –¥–ª—è "–æ—Å—Ç–∞–ª—å–Ω—ã—Ö" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —á—Ç–æ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç
Snyk –≤–æ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é.

### –ü—Ä–∏—á–∏–Ω–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è

- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (Backrest, Grafana) –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º root –∏–ª–∏
  —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ UID
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- Snyk —Å–∫–∞–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è konstantin
- –†–∞–∑–ª–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
sudo ./scripts/maintenance/fix-data-permissions.sh

# –ò–ª–∏ —Ä—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:
sudo chmod 755 data/backrest/repos
sudo chmod -R 755 data/backrest/repos/erni-ki-local
sudo chmod -R 755 data/grafana/alerting
sudo chmod 755 data/grafana/csv data/grafana/png
```

### 2. –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**Backrest:**

```bash
drwxr-xr-x  3 root root 4096 Jul 14 09:00 repos
drwxr-xr-x  7 root root 4096 Jul 14 09:00 erni-ki-local
```

**Grafana:**

```bash
drwxr-xr-x  3 472 root 4096 Jul 17 13:44 alerting
drwxr-xr-x  2 472 root 4096 Jul 17 13:44 csv
drwxr-xr-x  2 472 root 4096 Jul 17 13:44 png
```

**–ü—Ä–∞–≤–∞ `755` (drwxr-xr-x)**:

- –í–ª–∞–¥–µ–ª–µ—Ü (root): —á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –ì—Ä—É–ø–ø–∞: —á—Ç–µ–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- –û—Å—Ç–∞–ª—å–Ω—ã–µ: —á—Ç–µ–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –¢–æ–ª—å–∫–æ root –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å —Ñ–∞–π–ª—ã Backrest
- ‚úÖ –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø –Ω–∞ —á—Ç–µ–Ω–∏–µ
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞—â–∏—â—ë–Ω–Ω–æ–π
- ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö Backrest –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Snyk

–§–∞–π–ª `.snyk` —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:

```yaml
exclude:
  - data/** # –ü–æ–∫—Ä—ã–≤–∞–µ—Ç data/backrest/repos/
  - .config-backup/**
```

## üîß –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `scripts/maintenance/fix-data-permissions.sh` –¥–ª—è:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ `data/`
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Backrest, Grafana, PostgreSQL)
- –°–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
sudo ./scripts/maintenance/fix-data-permissions.sh
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è

### 1. –î–æ—Å—Ç—É–ø –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Backrest
ls -la data/backrest/repos/erni-ki-local/
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Grafana
ls -la data/grafana/alerting/1/
# –î–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–µ–∑ –æ—à–∏–±–æ–∫
```

### 2. –†–∞–±–æ—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# Backrest
curl -s http://localhost:9898/ | head -5
# Grafana
curl -s http://localhost:3000/api/health
# –î–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
```

### 3. Snyk —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ä–∞–Ω–µ–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
find data/grafana/alerting/1 -type f | wc -l
find data/backrest/repos/erni-ki-local -type f | wc -l
# –î–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –±–µ–∑ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞
```

## üîÑ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

–î–æ–±–∞–≤–∏—Ç—å –≤ cron –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:

```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ 06:00
0 6 * * * /path/to/erni-ki/scripts/maintenance/fix-backrest-permissions.sh
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã

- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Backrest –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–æ–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ `logs/`

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- ‚ùå Snyk: "EACCES: permission denied" –¥–ª—è data/backrest/repos/erni-ki-local
- ‚ùå Snyk: "EACCES: permission denied" –¥–ª—è data/grafana/alerting/1
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–≤

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- ‚úÖ Snyk —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã (Backrest, Grafana, PostgreSQL) –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
- ‚úÖ PostgreSQL –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∞)

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [Backrest Integration](backrest-integration.md)
- [Local Backup Restore Guide](local-backup-restore-guide.md)
- [Security Configuration](security-configuration.md)

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ—à–µ–Ω–æ **–î–∞—Ç–∞**: 2025-08-04 **–ê–≤—Ç–æ—Ä**: –ê–ª—å—Ç—ç–æ–Ω –®—É–ª—å—Ü (Tech Lead)
**–í–µ—Ä—Å–∏—è**: 1.0
