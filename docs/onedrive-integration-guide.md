# OneDrive –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ OpenWebUI –¥–ª—è ERNI-KI

**–î–∞—Ç–∞:** 29 –∞–≤–≥—É—Å—Ç–∞ 2025 **–í–µ—Ä—Å–∏—è:** 1.0 **–ê–≤—Ç–æ—Ä:** –ê–ª—å—Ç—ç–æ–Ω –®—É–ª—å—Ü, Tech Lead

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é OneDrive –≤ OpenWebUI —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑
Microsoft Entra ID –¥–ª—è ERNI-KI —Å–∏—Å—Ç–µ–º—ã. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º,
–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å RAG —Å–∏—Å—Ç–µ–º–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏.

---

## üîç 1. –ê–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ OneDrive

### 1.1 –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ OneDrive –≤ OpenWebUI

OneDrive –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ OpenWebUI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

**üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏:**

- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏–∑ OneDrive –≤ RAG —Å–∏—Å—Ç–µ–º—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (PDF, DOCX, XLSX, TXT, MD)
- –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø–∞–ø–∫–∞–º

**üîç RAG –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –±–∞–∑—É
- –ü–æ–∏—Å–∫ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Ñ–∞–π–ª–æ–≤ OneDrive
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

**üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

- OAuth 2.0 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Microsoft Entra ID
- –°–æ–±–ª—é–¥–µ–Ω–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞
- –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç—Ä–∞–Ω–∑–∏—Ç–µ –∏ –ø–æ–∫–æ–µ

### 1.2 –ú–µ—Ç–æ–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

| –ú–µ—Ç–æ–¥                   | OAuth 2.0        | Service Principal  | Managed Identity |
| ----------------------- | ---------------- | ------------------ | ---------------- |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**        | –í—ã—Å–æ–∫–∞—è          | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è      | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è     |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**          | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ   | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ   |
| **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**    | –°—Ä–µ–¥–Ω—è—è          | –í—ã—Å–æ–∫–∞—è            | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è     |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** | –ù–∏–∑–∫–∞—è           | –°—Ä–µ–¥–Ω—è—è            | –í—ã—Å–æ–∫–∞—è          |
| **–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è**        | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞       | –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–∞—è —Å—Ä–µ–¥–∞ | Azure-hosted     |

### 1.3 Microsoft Graph API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –∫–≤–æ—Ç—ã

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã:**

- **–ó–∞–ø—Ä–æ—Å—ã –≤ —Å–µ–∫—É–Ω–¥—É:** 10,000 –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ó–∞–ø—Ä–æ—Å—ã –≤ –º–∏–Ω—É—Ç—É:** 600,000 –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:** –î–æ 250 GB —á–µ—Ä–µ–∑ resumable upload
- **Batch –∑–∞–ø—Ä–æ—Å—ã:** –î–æ 20 –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –æ–¥–Ω–æ–º batch

**Throttling –ø–æ–ª–∏—Ç–∏–∫–∏:**

- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ throttling
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üîß 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 2.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

–î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è OneDrive –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ OpenWebUI –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# === ONEDRIVE INTEGRATION ===
# –í–∫–ª—é—á–∏—Ç—å OneDrive –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
ENABLE_ONEDRIVE_INTEGRATION=true

# Microsoft Graph API endpoint
MICROSOFT_GRAPH_ENDPOINT=https://graph.microsoft.com/v1.0

# === AZURE APP REGISTRATION ===
# Application (client) ID –∏–∑ Azure App Registration
AZURE_CLIENT_ID=your-client-id-here

# Client secret –∏–∑ Azure App Registration
AZURE_CLIENT_SECRET=your-client-secret-here

# Directory (tenant) ID
AZURE_TENANT_ID=your-tenant-id-here

# Redirect URI –¥–ª—è OAuth flow
AZURE_REDIRECT_URI=https://your-domain.com/api/auth/microsoft/callback

# === ONEDRIVE SETTINGS ===
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å RAG
ONEDRIVE_AUTO_SYNC_RAG=true

# –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–º–∏–Ω—É—Ç—ã)
ONEDRIVE_SYNC_INTERVAL=30

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (100MB)
ONEDRIVE_MAX_FILE_SIZE=104857600

# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ñ–∞–π–ª–æ–≤
ONEDRIVE_SUPPORTED_FORMATS=pdf,docx,xlsx,pptx,txt,md,csv

# –ü–∞–ø–∫–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—è—Ç—ã–º–∏)
ONEDRIVE_SYNC_FOLDERS=Documents,Shared Documents,AI Training Data

# === CACHING ===
# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (—Å–µ–∫—É–Ω–¥—ã)
ONEDRIVE_TOKEN_CACHE_TTL=3600

# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
ONEDRIVE_METADATA_CACHE_TTL=1800
```

### 2.2 Microsoft Graph API —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è Azure App Registration:

**Delegated permissions (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞):**

```
Files.Read.All          - –ß—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
Files.ReadWrite.All     - –ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
Sites.Read.All          - –î–æ—Å—Ç—É–ø –∫ SharePoint —Å–∞–π—Ç–∞–º
User.Read               - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
offline_access          - Refresh tokens –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
```

**Application permissions (–¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞):**

```
Files.Read.All          - –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
Files.ReadWrite.All     - –ó–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
Sites.Read.All          - –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º SharePoint —Å–∞–π—Ç–∞–º
User.Read.All           - –ß—Ç–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

### 2.3 –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å ERNI-KI –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏:**

```mermaid
graph TB
    subgraph "ERNI-KI OneDrive Integration"
        UI[OpenWebUI] --> Auth[auth-server]
        UI --> OneDrive[OneDrive Connector]
        OneDrive --> Graph[Microsoft Graph API]

        subgraph "Document Processing Pipeline"
            OneDrive --> Docling[Docling Service]
            OneDrive --> Tika[Apache Tika]
            Docling --> Vector[pgvector]
            Tika --> Vector
        end

        subgraph "Storage & Caching"
            OneDrive --> Redis[Redis Cache]
            Vector --> DB[(PostgreSQL)]
            OneDrive --> FileCache[File Cache]
        end

        subgraph "Monitoring"
            OneDrive --> Prometheus[Prometheus]
            OneDrive --> Loki[Loki Logs]
        end
    end

    style OneDrive fill:#0078d4,color:#fff
    style Graph fill:#0078d4,color:#fff
    style Auth fill:#28a745,color:#fff
```

**Nginx proxy –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**

- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è Microsoft Graph API –∑–∞–ø—Ä–æ—Å–æ–≤
- SSL termination –¥–ª—è OAuth callbacks
- Rate limiting –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

---

## üìñ 3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### 3.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Azure –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ App Registration

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Azure CLI
az ad app create \
  --display-name "ERNI-KI OneDrive Integration" \
  --sign-in-audience "AzureADMyOrg" \
  --web-redirect-uris "https://your-domain.com/api/auth/microsoft/callback" \
  --required-resource-accesses @app-permissions.json

# –°–æ–∑–¥–∞–Ω–∏–µ Service Principal
az ad sp create --id <application-id>

# –°–æ–∑–¥–∞–Ω–∏–µ client secret
az ad app credential reset --id <application-id> --append
```

#### –®–∞–≥ 2: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (app-permissions.json)

```json
[
  {
    "resourceAppId": "00000003-0000-0000-c000-000000000000",
    "resourceAccess": [
      {
        "id": "df021288-bdef-4463-88db-98f22de89214",
        "type": "Role"
      },
      {
        "id": "75359482-378d-4052-8f01-80520e7db3cd",
        "type": "Scope"
      },
      {
        "id": "863451e7-0667-486c-a5d6-d135439485f0",
        "type": "Scope"
      }
    ]
  }
]
```

### 3.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OpenWebUI

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ env/openwebui.env

```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ env/openwebui.env
cat >> env/openwebui.env << 'EOF'

# === ONEDRIVE INTEGRATION ===
# –í–∫–ª—é—á–∏—Ç—å OneDrive –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
ENABLE_ONEDRIVE_INTEGRATION=true

# Microsoft Graph API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
MICROSOFT_GRAPH_ENDPOINT=https://graph.microsoft.com/v1.0
MICROSOFT_GRAPH_BETA_ENDPOINT=https://graph.microsoft.com/beta

# Azure App Registration (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ –∑–Ω–∞—á–µ–Ω–∏—è)
AZURE_CLIENT_ID=your-client-id-from-app-registration
AZURE_CLIENT_SECRET=your-client-secret-from-app-registration
AZURE_TENANT_ID=your-tenant-id
AZURE_REDIRECT_URI=https://your-domain.com/api/auth/microsoft/callback

# OneDrive —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
ONEDRIVE_AUTO_SYNC_RAG=true
ONEDRIVE_SYNC_INTERVAL=30
ONEDRIVE_MAX_FILE_SIZE=104857600
ONEDRIVE_SUPPORTED_FORMATS=pdf,docx,xlsx,pptx,txt,md,csv,json

# –ü–∞–ø–∫–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
ONEDRIVE_SYNC_FOLDERS=Documents,AI Training Data,Knowledge Base

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
ONEDRIVE_TOKEN_CACHE_TTL=3600
ONEDRIVE_METADATA_CACHE_TTL=1800
ONEDRIVE_CONCURRENT_DOWNLOADS=5
ONEDRIVE_BATCH_SIZE=20

# === HYBRID DOCUMENT PROCESSING ===
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OneDrive + –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
ENABLE_HYBRID_DOCUMENT_SOURCES=true
HYBRID_SYNC_PRIORITY=onedrive,local,web

EOF
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docker-compose.yml

```yaml
# –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ—Ä–≤–∏—Å openwebui
services:
  openwebui:
    environment:
      # OneDrive Integration
      - ENABLE_ONEDRIVE_INTEGRATION=${ENABLE_ONEDRIVE_INTEGRATION:-false}
      - MICROSOFT_GRAPH_ENDPOINT=${MICROSOFT_GRAPH_ENDPOINT:-https://graph.microsoft.com/v1.0}
      - MICROSOFT_GRAPH_BETA_ENDPOINT=${MICROSOFT_GRAPH_BETA_ENDPOINT:-https://graph.microsoft.com/beta}

      # Azure Authentication
      - AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
      - AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET}
      - AZURE_TENANT_ID=${AZURE_TENANT_ID}
      - AZURE_REDIRECT_URI=${AZURE_REDIRECT_URI}

      # OneDrive Settings
      - ONEDRIVE_AUTO_SYNC_RAG=${ONEDRIVE_AUTO_SYNC_RAG:-true}
      - ONEDRIVE_SYNC_INTERVAL=${ONEDRIVE_SYNC_INTERVAL:-30}
      - ONEDRIVE_MAX_FILE_SIZE=${ONEDRIVE_MAX_FILE_SIZE:-104857600}
      - ONEDRIVE_SUPPORTED_FORMATS=${ONEDRIVE_SUPPORTED_FORMATS}
      - ONEDRIVE_SYNC_FOLDERS=${ONEDRIVE_SYNC_FOLDERS}

      # Caching
      - ONEDRIVE_TOKEN_CACHE_TTL=${ONEDRIVE_TOKEN_CACHE_TTL:-3600}
      - ONEDRIVE_METADATA_CACHE_TTL=${ONEDRIVE_METADATA_CACHE_TTL:-1800}
      - ONEDRIVE_CONCURRENT_DOWNLOADS=${ONEDRIVE_CONCURRENT_DOWNLOADS:-5}
      - ONEDRIVE_BATCH_SIZE=${ONEDRIVE_BATCH_SIZE:-20}

      # Hybrid Processing
      - ENABLE_HYBRID_DOCUMENT_SOURCES=${ENABLE_HYBRID_DOCUMENT_SOURCES:-false}
      - HYBRID_SYNC_PRIORITY=${HYBRID_SYNC_PRIORITY:-onedrive,local,web}
```

### 3.3 OAuth Consent –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Admin Consent

```bash
# –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ admin consent –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
az ad app permission admin-consent --id <application-id>

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
az ad app permission list --id <application-id>
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Conditional Access (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```json
{
  "displayName": "ERNI-KI OneDrive Access Policy",
  "state": "enabled",
  "conditions": {
    "applications": {
      "includeApplications": ["<your-app-id>"]
    },
    "users": {
      "includeGroups": ["<ai-users-group-id>"]
    }
  },
  "grantControls": {
    "operator": "AND",
    "builtInControls": ["mfa", "compliantDevice"]
  }
}
```

---

## üèóÔ∏è 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ERNI-KI

### 4.1 –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ nginx proxy:**

- –ù–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è Microsoft Graph API
- OAuth callback handling
- Rate limiting –¥–ª—è OneDrive –æ–ø–µ—Ä–∞—Ü–∏–π

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ auth-server:**

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Microsoft OAuth tokens
- Token refresh –º–µ—Ö–∞–Ω–∏–∑–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ PostgreSQL:**

- –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è OneDrive –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
- –°–≤—è–∑–∏ —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### 4.2 –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º downtime

#### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (0 downtime)

```bash
# 1. –°–æ–∑–¥–∞–Ω–∏–µ Azure App Registration
./scripts/setup-onedrive-integration.sh --create-app

# 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
cp env/openwebui.env env/openwebui.env.backup
echo "# OneDrive config" >> env/openwebui.env

# 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
./scripts/prepare-onedrive-schema.sql
```

#### –§–∞–∑–∞ 2: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (< 60 —Å–µ–∫—É–Ω–¥ downtime)

```bash
# 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
docker-compose up -d openwebui

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
./scripts/test-onedrive-integration.sh

# 3. –û—Ç–∫–∞—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
# docker-compose down openwebui && cp env/openwebui.env.backup env/openwebui.env && docker-compose up -d openwebui
```

#### –§–∞–∑–∞ 3: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (0 downtime)

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
./scripts/comprehensive-onedrive-test.sh
```

### 4.3 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
REDIS_TOKEN_ENCRYPTION_KEY=your-32-byte-encryption-key
REDIS_TOKEN_TTL=3600

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ client secrets –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
AZURE_CLIENT_SECRET_ENCRYPTED=true
ENCRYPTION_KEY_PATH=/secrets/encryption.key
```

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```yaml
# Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è OneDrive –æ–ø–µ—Ä–∞—Ü–∏–π
onedrive_auth_failures_total onedrive_api_rate_limit_hits_total
onedrive_token_refresh_failures_total onedrive_unauthorized_access_attempts_total
```

#### –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π

```json
{
  "timestamp": "2025-08-29T10:30:00Z",
  "user": "user@company.com",
  "action": "file_download",
  "resource": "/Documents/sensitive-doc.pdf",
  "ip_address": "192.168.1.100",
  "user_agent": "ERNI-KI-OpenWebUI/1.0",
  "status": "success"
}
```

---

## üîÑ 5. RAG –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç

### 5.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

#### Webhook –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```bash
# Microsoft Graph webhook subscription
POST https://graph.microsoft.com/v1.0/subscriptions
{
  "changeType": "created,updated,deleted",
  "notificationUrl": "https://your-domain.com/api/webhooks/onedrive",
  "resource": "/me/drive/root",
  "expirationDateTime": "2025-09-29T10:30:00Z",
  "clientState": "your-secret-state"
}
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤

```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook —Å–æ–±—ã—Ç–∏–π
def handle_onedrive_webhook(event):
    if event.changeType == "created":
        download_and_index_file(event.resource)
    elif event.changeType == "updated":
        reindex_file(event.resource)
    elif event.changeType == "deleted":
        remove_from_index(event.resource)
```

### 5.2 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pgvector –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è OneDrive –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
CREATE TABLE onedrive_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    file_id VARCHAR(255) UNIQUE NOT NULL,
    file_name VARCHAR(500) NOT NULL,
    file_path TEXT NOT NULL,
    file_size BIGINT,
    mime_type VARCHAR(100),
    last_modified TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    sync_status VARCHAR(50) DEFAULT 'pending',
    embedding_id UUID REFERENCES embeddings(id),
    INDEX idx_file_id (file_id),
    INDEX idx_sync_status (sync_status),
    INDEX idx_last_modified (last_modified)
);

-- –°–≤—è–∑—å —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
CREATE TABLE onedrive_embeddings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    file_id UUID REFERENCES onedrive_files(id),
    chunk_index INTEGER,
    content TEXT,
    embedding vector(1536),
    metadata JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_onedrive_embeddings_vector
ON onedrive_embeddings USING ivfflat (embedding vector_cosine_ops);
```

### 5.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Docling –∏ Tika

```yaml
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
document_processors:
  pdf:
    primary: docling
    fallback: tika
    extract_images: true
    ocr_enabled: true

  docx:
    primary: docling
    extract_tables: true
    preserve_formatting: true

  xlsx:
    primary: tika
    extract_sheets: all
    include_formulas: false

  pptx:
    primary: docling
    extract_slides: true
    include_notes: true
```

#### –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è OCR –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ–º–µ—Ü–∫–æ–≥–æ, –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ, —Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–≥–æ, –∏—Ç–∞–ª—å—è–Ω—Å–∫–æ–≥–æ
DOCLING_OCR_LANGUAGES=deu,eng,fra,ita
DOCLING_AUTO_LANGUAGE_DETECTION=true
DOCLING_OCR_CONFIDENCE_THRESHOLD=0.8
```

### 5.4 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

#### Workflow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```mermaid
sequenceDiagram
    participant OD as OneDrive
    participant OW as OpenWebUI
    participant DL as Docling
    participant TK as Tika
    participant PG as PostgreSQL
    participant VD as pgvector

    OD->>OW: Webhook: File Updated
    OW->>OD: Download File
    OW->>DL: Process Document
    alt Docling Success
        DL->>OW: Extracted Content
    else Docling Failure
        OW->>TK: Fallback Processing
        TK->>OW: Extracted Content
    end
    OW->>VD: Generate Embeddings
    OW->>PG: Store Metadata
    VD->>PG: Store Vectors
    OW->>OW: Update RAG Index
```

---

## üìä 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥

### 6.1 Prometheus –º–µ—Ç—Ä–∏–∫–∏

```yaml
# OneDrive –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫–∏
onedrive_files_total{status="synced|pending|failed"} onedrive_sync_duration_seconds
onedrive_api_requests_total{method="GET|POST|PATCH",status="2xx|4xx|5xx"}
onedrive_token_refresh_total{status="success|failure"}
onedrive_webhook_events_total{type="created|updated|deleted"}
onedrive_file_processing_duration_seconds{processor="docling|tika"} onedrive_storage_usage_bytes
onedrive_rate_limit_remaining
```

### 6.2 Grafana –¥–∞—à–±–æ—Ä–¥

```json
{
  "dashboard": {
    "title": "ERNI-KI OneDrive Integration",
    "panels": [
      {
        "title": "OneDrive Sync Status",
        "type": "stat",
        "targets": [
          {
            "expr": "sum by (status) (onedrive_files_total)"
          }
        ]
      },
      {
        "title": "API Request Rate",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(onedrive_api_requests_total[5m])"
          }
        ]
      },
      {
        "title": "File Processing Time",
        "type": "heatmap",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(onedrive_file_processing_duration_seconds_bucket[5m]))"
          }
        ]
      }
    ]
  }
}
```

### 6.3 Alerting –ø—Ä–∞–≤–∏–ª–∞

```yaml
# Prometheus alerting rules
groups:
  - name: onedrive_integration
    rules:
      - alert: OneDriveHighFailureRate
        expr: rate(onedrive_api_requests_total{status=~"4xx|5xx"}[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: 'High OneDrive API failure rate'
          description: 'OneDrive API failure rate is {{ $value }} requests/sec'

      - alert: OneDriveTokenRefreshFailure
        expr: increase(onedrive_token_refresh_total{status="failure"}[10m]) > 3
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: 'OneDrive token refresh failures'
          description: 'Multiple OneDrive token refresh failures detected'

      - alert: OneDriveSyncLag
        expr: time() - onedrive_last_successful_sync_timestamp > 3600
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: 'OneDrive sync lag detected'
          description: "OneDrive hasn't synced successfully for over 1 hour"
```

---

## üß™ 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ troubleshooting

### 7.1 –ü—Ä–æ—Ü–µ–¥—É—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Microsoft Graph

```bash
# –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl -H "Authorization: Bearer $ACCESS_TOKEN" \
  "https://graph.microsoft.com/v1.0/me/drive"

# –¢–µ—Å—Ç —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
curl -H "Authorization: Bearer $ACCESS_TOKEN" \
  "https://graph.microsoft.com/v1.0/me/drive/root/children"
```

#### –¢–µ—Å—Ç OAuth flow

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ authorization code
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
  client_id={client_id}&
  response_type=code&
  redirect_uri={redirect_uri}&
  response_mode=query&
  scope=Files.Read.All%20Files.ReadWrite.All%20offline_access

# –û–±–º–µ–Ω code –Ω–∞ access token
curl -X POST https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "client_id={client_id}&client_secret={client_secret}&code={code}&redirect_uri={redirect_uri}&grant_type=authorization_code"
```

### 7.2 Troubleshooting guide

#### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞: "invalid_client" –æ—à–∏–±–∫–∞**

```bash
# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å client_id –∏ client_secret
az ad app show --id $AZURE_CLIENT_ID
az ad app credential list --id $AZURE_CLIENT_ID
```

**–ü—Ä–æ–±–ª–µ–º–∞: "insufficient_privileges" –æ—à–∏–±–∫–∞**

```bash
# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å admin consent
az ad app permission admin-consent --id $AZURE_CLIENT_ID
```

**–ü—Ä–æ–±–ª–µ–º–∞: Rate limiting (429 –æ—à–∏–±–∫–∏)**

```bash
# –†–µ—à–µ–Ω–∏–µ: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å exponential backoff
ONEDRIVE_RETRY_ATTEMPTS=3
ONEDRIVE_RETRY_DELAY=1
ONEDRIVE_BACKOFF_MULTIPLIER=2
```

**–ü—Ä–æ–±–ª–µ–º–∞: Token expiration**

```bash
# –†–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh —Ç–æ–∫–µ–Ω–æ–≤
ONEDRIVE_AUTO_TOKEN_REFRESH=true
ONEDRIVE_TOKEN_REFRESH_THRESHOLD=300  # 5 –º–∏–Ω—É—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
```

### 7.3 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```json
{
  "timestamp": "2025-08-29T10:30:00Z",
  "level": "INFO",
  "component": "onedrive_connector",
  "operation": "file_sync",
  "file_id": "01BYE5RZ6QN3ZWBTUFOFD3GSPGOHDJD36K",
  "file_name": "document.pdf",
  "duration_ms": 1250,
  "status": "success",
  "metadata": {
    "file_size": 2048576,
    "mime_type": "application/pdf",
    "processing_engine": "docling"
  }
}
```

#### Debug —Ä–µ–∂–∏–º

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
ONEDRIVE_DEBUG_MODE=true
ONEDRIVE_LOG_LEVEL=DEBUG
ONEDRIVE_LOG_API_REQUESTS=true
ONEDRIVE_LOG_TOKEN_OPERATIONS=false  # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å!
```

---

## üìö –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

OneDrive –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ ERNI-KI –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚úÖ **–ë–µ—Å—à–æ–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø** –∫ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** —Å RAG
—Å–∏—Å—Ç–µ–º–æ–π ‚úÖ **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ Azure Entra ID ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** –¥–ª—è –±–æ–ª—å—à–∏—Ö
–æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥** –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. –í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É Azure App Registration
2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ERNI-KI
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
5. –û–±—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞:**

- `scripts/setup-onedrive-integration.sh` - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- `scripts/test-onedrive-integration.sh` - –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `docs/onedrive-troubleshooting.md` - –î–µ—Ç–∞–ª—å–Ω—ã–π troubleshooting guide
